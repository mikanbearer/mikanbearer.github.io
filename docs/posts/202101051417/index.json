



    
        
    




{
  "result": {
    "content": "\u003cp\u003e這次練習從網路上抓資料來處理，並使用LINE Messaging API來發推送訊息，畢竟這方式不但比mail簡單得多，也更即時更實用\u003c/p\u003e\n\u003cp\u003eNode-RED一樣是之前用compose file建立的container，版本是1.2.6\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003enode-red_1  | Welcome to Node-RED\r\nnode-red_1  | ===================\r\nnode-red_1  | \r\nnode-red_1  | 6 Jan 16:26:46 - [info] Node-RED version: v1.2.6\r\nnode-red_1  | 6 Jan 16:26:46 - [info] Node.js  version: v10.23.0\r\nnode-red_1  | 6 Jan 16:26:46 - [info] Linux 3.10.0-1160.11.1.el7.x86_64 x64 LE\r\n...\r\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003ch3 id=\"line-messaging-api\"\u003eLINE Messaging API\u003c/h3\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e首先進入\u003ca href=\"https://developers.line.biz/\" target=\"_blank\"\u003eLINE Developers\u003c/a\u003e，登入至console後建立provider，並在這個provider建立一個channel，建立完成後取\u0026quot;Basic\u0026quot;中的user id\n\u003cimg src=\"1.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e與\u0026quot;Messaging API\u0026quot;中的Channel access token\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"2.png\" alt=\"\"\u003e\n\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e測試就像這樣，來個哈囉沃德吧！POST Content是JSON，content中的\u0026quot;to\u0026quot;填入的是剛才的user id，而header中的Authorization: Bearer token就是剛才的Channel access token\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$ curl -X POST https://api.line.me/v2/bot/message/push \\\r\n    -H 'Content-Type: application/json' \\ \r\n    -H 'Authorization: Bearer yU5C4Y5Jfihkn/c5lzIA0w....' \\\r\n    -d '{\u0026quot;to\u0026quot;:\u0026quot;U0e9aa2....\u0026quot;,\u0026quot;messages\u0026quot;:[{\u0026quot;type\u0026quot;:\u0026quot;text\u0026quot;,\u0026quot;text\u0026quot;:\u0026quot;Hello, world!\u0026quot;}]}'\r\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003eresponse是個空白的JSON就代表成功了\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e{}\r\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003eLINE有加自己的Channel就能看到剛才的推送訊息，如此一來就完成一將近一半了\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"3.png\" alt=\"\"\u003e\n\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003ch3 id=\"使用node-red操作line-messaging-api\"\u003e使用Node-RED操作LINE Messaging API\u003c/h3\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e接下來回到Node-RED，開啟一個flow，inject執行一次且不repeat，整體如下圖所示\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"4.png\" alt=\"\"\u003e\n\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003efunction node用來設定payload，也就是要POST的data，header的部分Authorization能放在http request那裡，所以這裡就不動了\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"color:#a6e22e\"\u003emsg\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eheaders\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {};\n\u003cspan style=\"color:#a6e22e\"\u003emsg\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eheaders\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Content-Type\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;application/json\u0026#39;\u003c/span\u003e;\n\u003cspan style=\"color:#a6e22e\"\u003emsg\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003epayload\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;{\u0026#34;to\u0026#34;:\u0026#34;U0e9aa299...\u0026#34;,\u0026#34;messages\u0026#34;:[{\u0026#34;type\u0026#34;:\u0026#34;text\u0026#34;,\u0026#34;text\u0026#34;:\u0026#34;來自Flow1的Hello, world!\u0026#34;}]}\u0026#39;\u003c/span\u003e;\n\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emsg\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003erequest node設定url及auth，bearer token放在這裡，如此一來token就不用寫在function node內\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"5.png\" alt=\"\"\u003e\n\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003eDeploy後就能收到訊息了\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"6.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003ch3 id=\"抓取資料並發送訊息\"\u003e抓取資料並發送訊息\u003c/h3\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e雖然抓個天氣或是匯率之類的…但似乎有點難實現，所以這部分有點小尷尬，HTML node雖然能用CSS selector但還是稍嫌陽春，沒辦法用DOM操作的話抓取資料還是有點麻煩，為了避免節外生枝，臺灣銀行的牌告匯率有txt版本的，如此一來就不需要動settings.js，也不需要思考html decode的問題\u003c/p\u003e\n\u003cp\u003e首先在timestamp的後面插入http request node與function node各一，如圖所示\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"7.png\" alt=\"\"\u003e\n\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003eGET的url就是臺灣銀行txt的所在位置，沒什麼亮點\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"8.png\" alt=\"\"\u003e\n\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003efilter稍微冗長一點，\u003ccode\u003econtent-disposition\u003c/code\u003e這個header中的filename剛好是掛牌時間，所以抓出來連同txt的內容一併處理成要推送的訊息，資料長了不好看，取排第一個的美金就好\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"color:#a6e22e\"\u003enewMsg\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {};\n\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ef_match\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emsg\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eheaders\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;content-disposition\u0026#39;\u003c/span\u003e].\u003cspan style=\"color:#a6e22e\"\u003ematch\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e/filename=\u0026#34;ExchangeRate@(\\d+)/\u003c/span\u003e)[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e];\n\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edate\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ef_match\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eslice\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;-\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ef_match\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eslice\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;-\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ef_match\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eslice\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39; \u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ef_match\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eslice\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;:\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ef_match\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eslice\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e12\u003c/span\u003e);\n\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eexchange\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emsg\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003epayload\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003esplit\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\\n\u0026#39;\u003c/span\u003e);\n\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eusd\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eexchange\u003c/span\u003e[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e].\u003cspan style=\"color:#a6e22e\"\u003esplit\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e/ +/\u003c/span\u003e);\n\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emessage\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;臺灣銀行\u0026#39;\u003c/span\u003e  \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eusd\u003c/span\u003e[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;牌告匯率： \\\\n即期買入： \u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eusd\u003c/span\u003e[\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\\\\n即期賣出： \u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eusd\u003c/span\u003e[\u003cspan style=\"color:#ae81ff\"\u003e13\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\\\\n\\\\n掛牌時間： \u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edate\u003c/span\u003e\n\u003cspan style=\"color:#a6e22e\"\u003enewMsg\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;payload\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emessage\u003c/span\u003e;\n\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003enewMsg\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003eDeploy後就大功告成啦\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"9.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003ch3 id=\"重複執行上述動作\"\u003e重複執行上述動作\u003c/h3\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003eFlow總不可能deploy後只做一次就放在那邊吧？但持續發送訊息洗頻也是滿可怕的，這時候就來加個判斷，首先新增switch與change兩個node在filter後面串起來\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"10.png\" alt=\"\"\u003e\n\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e首先修改filter，把date獨立拉出來\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"color:#a6e22e\"\u003enewMsg\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {};\n\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ef_match\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emsg\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eheaders\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;content-disposition\u0026#39;\u003c/span\u003e].\u003cspan style=\"color:#a6e22e\"\u003ematch\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e/filename=\u0026#34;ExchangeRate@(\\d+)/\u003c/span\u003e)[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e];\n\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edate\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ef_match\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eslice\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;-\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ef_match\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eslice\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;-\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ef_match\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eslice\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39; \u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ef_match\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eslice\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;:\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ef_match\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eslice\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e12\u003c/span\u003e);\n\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eexchange\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emsg\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003epayload\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003esplit\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\\n\u0026#39;\u003c/span\u003e);\n\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eusd\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eexchange\u003c/span\u003e[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e].\u003cspan style=\"color:#a6e22e\"\u003esplit\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e/ +/\u003c/span\u003e);\n\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emessage\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;臺灣銀行\u0026#39;\u003c/span\u003e  \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eusd\u003c/span\u003e[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;牌告匯率： \\\\n即期買入： \u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eusd\u003c/span\u003e[\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\\\\n即期賣出： \u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eusd\u003c/span\u003e[\u003cspan style=\"color:#ae81ff\"\u003e13\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\\\\n\\\\n掛牌時間： \u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edate\u003c/span\u003e\n\u003cspan style=\"color:#a6e22e\"\u003enewMsg\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;payload\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emessage\u003c/span\u003e;\n\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"color:#a6e22e\"\u003enewMsg\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;date\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edate\u003c/span\u003e;\n\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003enewMsg\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e接下來是switch node，這裡就要透過context來查上一次執行的值，否則\u003ccode\u003emsg\u003c/code\u003e是會直接被timestamp刷掉，這個switch負責判斷\u003ccode\u003emsg.date\u003c/code\u003e與\u003ccode\u003eflow.date\u003c/code\u003e是否相同\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"12.png\" alt=\"\"\u003e\n\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e如果是true，就執行前一部份送訊息的動作，以及執行change node，將剛才function node的\u003ccode\u003emsg.date\u003c/code\u003e塞進\u003ccode\u003eflow.date\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"11.png\" alt=\"\"\u003e\n\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e執行就會發現context這裡的\u003ccode\u003eflow.date\u003c/code\u003e是有東西的\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"13.png\" alt=\"\"\u003e\n\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e如此一來就能將timestamp設定interval了，這裡的範例是1 min，如果date和上次不同才會發送訊息，結果如下圖\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"14.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e隨著工作複雜化限制也愈多，有時候覺得比coding還難…好處就是看起來更直觀，下次有空再來嘗試更進階一點的用法\u003c/p\u003e",
    "kind": "page",
    "params": {
      "categories": [
        "RPA"
      ],
      "date": "2021-01-05T14:17:14+08:00",
      "draft": false,
      "iscjklanguage": true,
      "lastmod": "2021-01-05T14:17:14+08:00",
      "publishdate": "2021-01-05T14:17:14+08:00",
      "tags": [
        "Node-RED",
        "LINE"
      ],
      "title": "使用LINE發送Node-RED爬蟲資料"
    },
    "permalink": "https://mikanbearer.github.io/posts/202101051417/index.json",
    "type": "posts",
    "wordcount": 1861
  }
}