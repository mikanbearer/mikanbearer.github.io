



    
        
    




{
  "result": {
    "content": "\u003cp\u003e\u003ca href=\"#/posts/posts%2F202104010856\" target=\"_blank\"\u003e前一篇\u003c/a\u003e的補充，利用filebeat module來更簡單地達成目標，這次不透過logstash，直接使用filebeat輸出到elasticsearch\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca onclick=\"window.scrollTo({top: document.getElementById(1).offsetTop, behavior: 'smooth'})\"\u003e使用Filebeat Zeek Module\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca onclick=\"window.scrollTo({top: document.getElementById(2).offsetTop, behavior: 'smooth'})\"\u003e設定Zeek\u003c/a\u003e\n\u003cbr\u003e\u003c/br\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e使用Filebeat Zeek Module\u003c/h2\u003e\r\n\u003chr\u003e\n\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\n一樣是CentOS 7\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e[root@node1 ~]# cat  /etc/*-release\r\nCentOS Linux release 7.9.2009 (Core)\r\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003efilebeat的版本\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e[root@node1 ~]# filebeat version\r\nfilebeat version 7.12.0 (amd64), libbeat 7.12.0 [08e20483a651ea5ad60115f68ff0e53e6360573a built 2021-03-18 06:16:51 +0000 UTC]\r\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e/etc/filebeat/modules.d/\u003c/code\u003e下包含了很多module，預設會是.disable的\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e[root@node1 ~]# ls /etc/filebeat/modules.d/ | grep zeek \r\nzeek.yml.disabled\r\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\n可以使用以下指令啟用\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e[root@node1 ~]# filebeat modules enable zeek\r\nEnabled zeek\r\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e[root@node1 docker-elk]# ls /etc/filebeat/modules.d/ | grep zeek \r\nzeek.yml\r\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e[root@node1 ~]# filebeat modules enable zeek\r\nEnabled zeek\r\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e接著修改內容，增加path\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-:/etc/filebeat/modules.d/zeek.yml\" data-lang=\":/etc/filebeat/modules.d/zeek.yml\"\u003e- \u003cspan style=\"color:#f92672\"\u003emodule\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ezeek\u003c/span\u003e\n  \u003cspan style=\"color:#f92672\"\u003ecapture_loss\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/capture_loss.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003econnection\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/conn.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003edce_rpc\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/dce_rpc.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003edhcp\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/dhcp.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003ednp3\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/dnp3.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003edns\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/dns.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003edpd\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/dpd.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003efiles\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/files.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003eftp\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/ftp.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003ehttp\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/http.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003eintel\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/intel.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003eirc\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/irc.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003ekerberos\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/kerberos.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003emodbus\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/modbus.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003emysql\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/mysql.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003enotice\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/notice.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003entlm\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/ntlm.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003eocsp\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/ocsp.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003epe\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/pe.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003eradius\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/radius.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003erdp\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/rdp.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003erfb\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/rfb.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003esip\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/sip.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003esmb_cmd\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/smb_cmd.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003esmb_files\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/smb_files.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003esmb_mapping\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/smb_mapping.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003esmtp\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/smtp.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003esnmp\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/snmp.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003esocks\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/socks.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003essh\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/ssh.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003essl\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/ssl.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003estats\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/stats.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003esyslog\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/syslog.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003etraceroute\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/traceroute.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003etunnel\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/tunnel.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003eweird\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/weird.log\u0026#34;\u003c/span\u003e]\n  \u003cspan style=\"color:#f92672\"\u003ex509\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003eenabled\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evar.paths\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/opt/zeek/logs/current/x509.log\u0026#34;\u003c/span\u003e]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e直接輸出到elasticsearch的話要記得相應的認證\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-:/etc/filebeat/filebeat.yml\" data-lang=\":/etc/filebeat/filebeat.yml\"\u003e...\n\u003cspan style=\"color:#f92672\"\u003eoutput.elasticsearch\u003c/span\u003e:\n  \u003cspan style=\"color:#75715e\"\u003e# Array of hosts to connect to.\u003c/span\u003e\n  \u003cspan style=\"color:#f92672\"\u003ehosts\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;localhost:9200\u0026#34;\u003c/span\u003e]\n\n  \u003cspan style=\"color:#75715e\"\u003e# Protocol - either `http` (default) or `https`.\u003c/span\u003e\n  \u003cspan style=\"color:#75715e\"\u003e#protocol: \u0026#34;https\u0026#34;\u003c/span\u003e\n\n  \u003cspan style=\"color:#75715e\"\u003e# Authentication credentials - either API key or username/password.\u003c/span\u003e\n  \u003cspan style=\"color:#75715e\"\u003e#api_key: \u0026#34;id:api_key\u0026#34;\u003c/span\u003e\n  \u003cspan style=\"color:#f92672\"\u003eusername\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;elastic\u0026#34;\u003c/span\u003e\n  \u003cspan style=\"color:#f92672\"\u003epassword\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;changeme\u0026#34;\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003ch2 id=2\u003e設定Zeek\u003c/h2\u003e\r\n\u003chr\u003e\n\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e為了輸出json，底下加上這行\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-:/opt/zeek/share/zeek/site/local.zeek\" data-lang=\":/opt/zeek/share/zeek/site/local.zeek\"\u003e...\r\n@load policy/tuning/json-logs.zeek\r\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e接著使用\u003ccode\u003ezeekctl deploy\u003c/code\u003e來套用新設定\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e[ZeekControl] \u0026gt; deploy\r\nchecking configurations ...\r\ninstalling ...\r\nremoving old policies in /opt/zeek/spool/installed-scripts-do-not-touch/site ...\r\nremoving old policies in /opt/zeek/spool/installed-scripts-do-not-touch/auto ...\r\ncreating policy directories ...\r\ninstalling site policies ...\r\ngenerating standalone-layout.zeek ...\r\ngenerating local-networks.zeek ...\r\ngenerating zeekctl-config.zeek ...\r\ngenerating zeekctl-config.sh ...\r\nstopping ...\r\nstopping zeek ...\r\nstarting ...\r\nstarting zeek ...\r\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\nlog黨就是json了\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-:/opt/zeek/logs/current/conn.log\" data-lang=\":/opt/zeek/logs/current/conn.log\"\u003e{\u0026quot;ts\u0026quot;:1617281330.214916,\u0026quot;uid\u0026quot;:\u0026quot;CstOjx2o7wtZ2jfpZ9\u0026quot;,\u0026quot;id.orig_h\u0026quot;:\u0026quot;192.168.149.131\u0026quot;,\u0026quot;id.orig_p\u0026quot;:46144,\u0026quot;id.resp_h\u0026quot;:\u0026quot;172.217.160.100\u0026quot;,\u0026quot;id.resp_p\u0026quot;:80,\u0026quot;proto\u0026quot;:\u0026quot;tcp\u0026quot;,\u0026quot;conn_state\u0026quot;:\u0026quot;OTH\u0026quot;,\u0026quot;local_orig\u0026quot;:true,\u0026quot;local_resp\u0026quot;:false,\u0026quot;missed_bytes\u0026quot;:0,\u0026quot;history\u0026quot;:\u0026quot;C\u0026quot;,\u0026quot;orig_pkts\u0026quot;:0,\u0026quot;orig_ip_bytes\u0026quot;:0,\u0026quot;resp_pkts\u0026quot;:0,\u0026quot;resp_ip_bytes\u0026quot;:0}\r\n{\u0026quot;ts\u0026quot;:1617281330.218891,\u0026quot;uid\u0026quot;:\u0026quot;CFIJJN1HMoiQv9Jqth\u0026quot;,\u0026quot;id.orig_h\u0026quot;:\u0026quot;192.168.149.131\u0026quot;,\u0026quot;id.orig_p\u0026quot;:46144,\u0026quot;id.resp_h\u0026quot;:\u0026quot;172.217.160.100\u0026quot;,\u0026quot;id.resp_p\u0026quot;:80,\u0026quot;proto\u0026quot;:\u0026quot;tcp\u0026quot;,\u0026quot;duration\u0026quot;:0.015105009078979493,\u0026quot;orig_bytes\u0026quot;:0,\u0026quot;resp_bytes\u0026quot;:1186,\u0026quot;conn_state\u0026quot;:\u0026quot;SHR\u0026quot;,\u0026quot;local_orig\u0026quot;:true,\u0026quot;local_resp\u0026quot;:false,\u0026quot;missed_bytes\u0026quot;:0,\u0026quot;history\u0026quot;:\u0026quot;^hCadfA\u0026quot;,\u0026quot;orig_pkts\u0026quot;:1,\u0026quot;orig_ip_bytes\u0026quot;:40,\u0026quot;resp_pkts\u0026quot;:5,\u0026quot;resp_ip_bytes\u0026quot;:1390}\r\n{\u0026quot;ts\u0026quot;:1617281330.202926,\u0026quot;uid\u0026quot;:\u0026quot;C4uMSwsZ3rrjlfQm\u0026quot;,\u0026quot;id.orig_h\u0026quot;:\u0026quot;192.168.149.131\u0026quot;,\u0026quot;id.orig_p\u0026quot;:32887,\u0026quot;id.resp_h\u0026quot;:\u0026quot;8.8.8.8\u0026quot;,\u0026quot;id.resp_p\u0026quot;:53,\u0026quot;proto\u0026quot;:\u0026quot;udp\u0026quot;,\u0026quot;service\u0026quot;:\u0026quot;dns\u0026quot;,\u0026quot;duration\u0026quot;:0.0071680545806884769,\u0026quot;orig_bytes\u0026quot;:0,\u0026quot;resp_bytes\u0026quot;:108,\u0026quot;conn_state\u0026quot;:\u0026quot;SHR\u0026quot;,\u0026quot;local_orig\u0026quot;:true,\u0026quot;local_resp\u0026quot;:false,\u0026quot;missed_bytes\u0026quot;:0,\u0026quot;history\u0026quot;:\u0026quot;Cd\u0026quot;,\u0026quot;orig_pkts\u0026quot;:0,\u0026quot;orig_ip_bytes\u0026quot;:0,\u0026quot;resp_pkts\u0026quot;:2,\u0026quot;resp_ip_bytes\u0026quot;:164}\r\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003eelssticsearch上也有資料\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e[root@node1 ~]# curl --user elastic:changeme 'http://localhost:9200/filebeat-*/_search?size=1'\r\n{\u0026quot;took\u0026quot;:1,\u0026quot;timed_out\u0026quot;:false,\u0026quot;_shards\u0026quot;:{\u0026quot;total\u0026quot;:1,\u0026quot;successful\u0026quot;:1,\u0026quot;skipped\u0026quot;:0,\u0026quot;failed\u0026quot;:0},\u0026quot;hits\u0026quot;:{\u0026quot;total\u0026quot;:{\u0026quot;value\u0026quot;:1151,\u0026quot;relation\u0026quot;:\u0026quot;eq\u0026quot;},\u0026quot;max_score\u0026quot;:1.0,\u0026quot;hits\u0026quot;:[{\u0026quot;_index\u0026quot;:\u0026quot;filebeat-7.12.0-2021.04.05-000001\u0026quot;,\u0026quot;_type\u0026quot;:\u0026quot;_doc\u0026quot;,\u0026quot;_id\u0026quot;:\u0026quot;sDNQo3gBibSuAk2M-jNv\u0026quot;,\u0026quot;_score\u0026quot;:1.0,\u0026quot;_source\u0026quot;:{\u0026quot;container\u0026quot;:{\u0026quot;id\u0026quot;:\u0026quot;conn.log\u0026quot;},\u0026quot;agent\u0026quot;:{\u0026quot;hostname\u0026quot;:\u0026quot;node1\u0026quot;,\u0026quot;name\u0026quot;:\u0026quot;node1\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;f3d3e18e-f980-40f7-bfd8-2309d02cf75c\u0026quot;,\u0026quot;type\u0026quot;:\u0026quot;filebeat\u0026quot;,\u0026quot;ephemeral_id\u0026quot;:\u0026quot;6b6e0855-2930-4ee3-94ba-1a8f2acdf205\u0026quot;,\u0026quot;version\u0026quot;:\u0026quot;7.12.0\u0026quot;},\u0026quot;log\u0026quot;:{\u0026quot;file\u0026quot;:{\u0026quot;path\u0026quot;:\u0026quot;/opt/zeek/logs/current/conn.log\u0026quot;},\u0026quot;offset\u0026quot;:0},\u0026quot;destination\u0026quot;:{\u0026quot;geo\u0026quot;:{\u0026quot;continent_name\u0026quot;:\u0026quot;North America\u0026quot;,\u0026quot;region_iso_code\u0026quot;:\u0026quot;US-CA\u0026quot;,\u0026quot;city_name\u0026quot;:\u0026quot;Mountain View\u0026quot;,\u0026quot;country_iso_code\u0026quot;:\u0026quot;US\u0026quot;,\u0026quot;country_name\u0026quot;:\u0026quot;United States\u0026quot;,\u0026quot;region_name\u0026quot;:\u0026quot;California\u0026quot;,\u0026quot;location\u0026quot;:{\u0026quot;lon\u0026quot;:-122.0748,\u0026quot;lat\u0026quot;:37.4043}},\u0026quot;as\u0026quot;:{\u0026quot;number\u0026quot;:15169,\u0026quot;organization\u0026quot;:{\u0026quot;name\u0026quot;:\u0026quot;Google LLC\u0026quot;}},\u0026quot;address\u0026quot;:\u0026quot;216.58.200.228\u0026quot;,\u0026quot;port\u0026quot;:80,\u0026quot;bytes\u0026quot;:0,\u0026quot;ip\u0026quot;:\u0026quot;216.58.200.228\u0026quot;,\u0026quot;packets\u0026quot;:0},\u0026quot;zeek\u0026quot;:{\u0026quot;session_id\u0026quot;:\u0026quot;COwaNN1ktf14jT99l9\u0026quot;,\u0026quot;connection\u0026quot;:{\u0026quot;local_resp\u0026quot;:false,\u0026quot;local_orig\u0026quot;:true,\u0026quot;missed_bytes\u0026quot;:0,\u0026quot;state\u0026quot;:\u0026quot;OTH\u0026quot;,\u0026quot;history\u0026quot;:\u0026quot;C\u0026quot;,\u0026quot;state_message\u0026quot;:\u0026quot;No SYN seen, just midstream traffic (a 'partial connection' that was not later closed).\u0026quot;}},\u0026quot;source\u0026quot;:{\u0026quot;address\u0026quot;:\u0026quot;192.168.171.130\u0026quot;,\u0026quot;port\u0026quot;:43270,\u0026quot;bytes\u0026quot;:0,\u0026quot;ip\u0026quot;:\u0026quot;192.168.171.130\u0026quot;,\u0026quot;packets\u0026quot;:0},\u0026quot;fileset\u0026quot;:{\u0026quot;name\u0026quot;:\u0026quot;connection\u0026quot;},\u0026quot;tags\u0026quot;:[\u0026quot;zeek.connection\u0026quot;,\u0026quot;local_orig\u0026quot;],\u0026quot;network\u0026quot;:{\u0026quot;community_id\u0026quot;:\u0026quot;1:9oBaDRLbI91mdMfEKoBlZhZAjtI=\u0026quot;,\u0026quot;bytes\u0026quot;:0,\u0026quot;transport\u0026quot;:\u0026quot;tcp\u0026quot;,\u0026quot;packets\u0026quot;:0,\u0026quot;direction\u0026quot;:\u0026quot;outbound\u0026quot;},\u0026quot;input\u0026quot;:{\u0026quot;type\u0026quot;:\u0026quot;log\u0026quot;},\u0026quot;@timestamp\u0026quot;:\u0026quot;2021-04-05T18:01:08.785Z\u0026quot;,\u0026quot;ecs\u0026quot;:{\u0026quot;version\u0026quot;:\u0026quot;1.8.0\u0026quot;},\u0026quot;related\u0026quot;:{\u0026quot;ip\u0026quot;:[\u0026quot;192.168.171.130\u0026quot;,\u0026quot;216.58.200.228\u0026quot;]},\u0026quot;service\u0026quot;:{\u0026quot;type\u0026quot;:\u0026quot;zeek\u0026quot;},\u0026quot;host\u0026quot;:{\u0026quot;hostname\u0026quot;:\u0026quot;node1\u0026quot;,\u0026quot;os\u0026quot;:{\u0026quot;kernel\u0026quot;:\u0026quot;3.10.0-1160.el7.x86_64\u0026quot;,\u0026quot;codename\u0026quot;:\u0026quot;Core\u0026quot;,\u0026quot;name\u0026quot;:\u0026quot;CentOS Linux\u0026quot;,\u0026quot;family\u0026quot;:\u0026quot;redhat\u0026quot;,\u0026quot;type\u0026quot;:\u0026quot;linux\u0026quot;,\u0026quot;version\u0026quot;:\u0026quot;7 (Core)\u0026quot;,\u0026quot;platform\u0026quot;:\u0026quot;centos\u0026quot;},\u0026quot;containerized\u0026quot;:false,\u0026quot;ip\u0026quot;:[\u0026quot;192.168.171.130\u0026quot;,\u0026quot;fe80::db7b:6d0e:41b9:ec9a\u0026quot;,\u0026quot;172.17.0.1\u0026quot;,\u0026quot;172.18.0.1\u0026quot;,\u0026quot;fe80::42:59ff:fea9:1241\u0026quot;,\u0026quot;fe80::a4c6:2dff:fec5:444a\u0026quot;,\u0026quot;fe80::8849:ceff:fe2c:130e\u0026quot;],\u0026quot;name\u0026quot;:\u0026quot;node1\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;c12fa2a2de0341ad9f01e392d13a476b\u0026quot;,\u0026quot;mac\u0026quot;:[\u0026quot;00:0c:29:a9:0b:d2\u0026quot;,\u0026quot;02:42:bb:db:00:b6\u0026quot;,\u0026quot;02:42:59:a9:12:41\u0026quot;,\u0026quot;a6:c6:2d:c5:44:4a\u0026quot;,\u0026quot;8a:49:ce:2c:13:0e\u0026quot;],\u0026quot;architecture\u0026quot;:\u0026quot;x86_64\u0026quot;},\u0026quot;event\u0026quot;:{\u0026quot;ingested\u0026quot;:\u0026quot;2021-04-05T18:34:56.047649006Z\u0026quot;,\u0026quot;kind\u0026quot;:\u0026quot;event\u0026quot;,\u0026quot;created\u0026quot;:\u0026quot;2021-04-05T18:34:51.064Z\u0026quot;,\u0026quot;module\u0026quot;:\u0026quot;zeek\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;COwaNN1ktf14jT99l9\u0026quot;,\u0026quot;category\u0026quot;:[\u0026quot;network\u0026quot;],\u0026quot;type\u0026quot;:[\u0026quot;connection\u0026quot;,\u0026quot;info\u0026quot;],\u0026quot;dataset\u0026quot;:\u0026quot;zeek.connection\u0026quot;}}}]}}\r\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e如此也能在kibana中的discover觀看了，如此就能開始做dashboard了\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"1.png\" alt=\"\"\u003e\u003c/p\u003e",
    "kind": "page",
    "params": {
      "categories": [
        "Security"
      ],
      "date": "2021-04-06T00:15:25+08:00",
      "draft": false,
      "iscjklanguage": true,
      "lastmod": "2021-04-06T00:15:25+08:00",
      "publishdate": "2021-04-06T00:15:25+08:00",
      "tags": [
        "Zeek",
        "Filebeat",
        "Elasticsearch"
      ],
      "title": "使用Filebeat輸出Zeek log至Elasticsearch"
    },
    "permalink": "https://mikanbearer.github.io/posts/2021/04/202104060015/index.json",
    "type": "posts",
    "wordcount": 705
  }
}