



    
        
    




{
  "result": {
    "content": "\u003cp\u003e工作上用到的零瑣筆記又一發，主要是在controller將query處理好，讓template產生JS code\u003c/p\u003e\n\u003cp\u003ejdk版本是1.8，使用maven，根據Thymeleaf的語法，不透過element輸出寫法是這樣\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e[[${Orz}]]\r\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e但如果是List、Array或其他什麼東西會很難使用，理想的情況還是在JS中call \u003ccode\u003eJSON.parse()\u003c/code\u003e，這樣就方便多了\u003c/p\u003e\n\u003cp\u003e所以這裡就先透過\u003ca href=\"https://github.com/alibaba/fastjson\" target=\"_blank\"\u003efastjson\u003c/a\u003e轉換成JSON String\n\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e在maven中下載：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-:pom.xml\" data-lang=\":pom.xml\"\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dependencies\u0026gt;\u003c/span\u003e\n    ...\n\n    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;dependency\u0026gt;\u003c/span\u003e\n        \u003cspan style=\"color:#f92672\"\u003e\u0026lt;groupId\u0026gt;\u003c/span\u003ecom.alibaba\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/groupId\u0026gt;\u003c/span\u003e\n        \u003cspan style=\"color:#f92672\"\u003e\u0026lt;artifactId\u0026gt;\u003c/span\u003efastjson\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/artifactId\u0026gt;\u003c/span\u003e\n        \u003cspan style=\"color:#f92672\"\u003e\u0026lt;version\u0026gt;\u003c/span\u003e1.2.73\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/version\u0026gt;\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;/dependency\u0026gt;\u003c/span\u003e\n\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/dependencies\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e這樣就能將List轉成Array的JSON String\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eList\u003cspan style=\"color:#f92672\"\u003e\u0026lt;?\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eextends\u003c/span\u003e Object\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e list \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e demoService\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003elistAll\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e();\u003c/span\u003e\nString json \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e JSONArray\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003etoJSONString\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003elist\u003cspan style=\"color:#f92672\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e需要作為Object使用的話就必須先轉換成map(※不太會處理key，待補完)\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003eMap\u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003eString\u003cspan style=\"color:#f92672\"\u003e,\u003c/span\u003e Object\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e map \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e list\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003estream\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e().\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ecollect\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eCollectors\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003etoMap\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eObject\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003etoString\u003cspan style=\"color:#f92672\"\u003e,\u003c/span\u003e Function\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eidentity\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e()));\u003c/span\u003e\nString json \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e JSON\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003etoJSONString\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003emap\u003cspan style=\"color:#f92672\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e接下來是示範用的controller\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-:demoController.java\" data-lang=\":demoController.java\"\u003e\u003cspan style=\"color:#f92672\"\u003e...\u003c/span\u003e\n\n\t\u003cspan style=\"color:#a6e22e\"\u003e@RequestMapping\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003evalue \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/list\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e,\u003c/span\u003e method \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e RequestMethod\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eGET\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\t\u003cspan style=\"color:#66d9ef\"\u003epublic\u003c/span\u003e ModelAndView \u003cspan style=\"color:#a6e22e\"\u003elist\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e()\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\t\t\u003cspan style=\"color:#75715e\"\u003e//取得query list\n\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\tList\u003cspan style=\"color:#f92672\"\u003e\u0026lt;?\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eextends\u003c/span\u003e Object\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e list \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e demoService\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003elistAll\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e();\u003c/span\u003e\n\n\t\t\u003cspan style=\"color:#75715e\"\u003e//將list轉換成json string\n\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e        String json \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e JSONArray\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003etoJSONString\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003elist\u003cspan style=\"color:#f92672\"\u003e);\u003c/span\u003e\n\n\t\t\u003cspan style=\"color:#75715e\"\u003e//ModelAndView\n\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\tModelAndView mView \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e ModelAndView\u003cspan style=\"color:#f92672\"\u003e();\u003c/span\u003e\n\t\tmView\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eaddObject\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;queryResult\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e,\u003c/span\u003e json\u003cspan style=\"color:#f92672\"\u003e;\u003c/span\u003e\n\t\tmView\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003esetViewName\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;template/html/list.html\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e);\u003c/span\u003e\n\t\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e mView\u003cspan style=\"color:#f92672\"\u003e;\u003c/span\u003e\n\t\u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e示範的template\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-list.html\" data-lang=\"list.html\"\u003e...\n\u0026lt;\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e\u0026gt;\n    \u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;[[${queryResult}]]\u0026#39;\u003c/span\u003e;\n\u0026lt;/\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e如此拿到的就會是一串有eacape的string\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u0026gt;\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e\n\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\u0026#34;\u003c/span\u003e[{\u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003equot\u003c/span\u003e;\u003cspan style=\"color:#a6e22e\"\u003ekey1\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003equot\u003c/span\u003e;\u003cspan style=\"color:#f92672\"\u003e:\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003equot\u003c/span\u003e;\u003cspan style=\"color:#a6e22e\"\u003evalue1\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003equot\u003c/span\u003e;,\u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003equot\u003c/span\u003e;\u003cspan style=\"color:#a6e22e\"\u003ekey2\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003equot\u003c/span\u003e;\u003cspan style=\"color:#f92672\"\u003e:\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003equot\u003c/span\u003e;\u003cspan style=\"color:#a6e22e\"\u003evalue2\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003equot\u003c/span\u003e;,\u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003equot\u003c/span\u003e;\u003cspan style=\"color:#a6e22e\"\u003ekey3\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003equot\u003c/span\u003e;\u003cspan style=\"color:#f92672\"\u003e:\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003equ\u003c/span\u003e...\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e基本上只有\u003ccode\u003e\u0026quot;\u003c/code\u003e被替換成\u003ccode\u003e\u0026amp;quot;\u003c/code\u003e，只要簡單的\u003ccode\u003ereplaceAll()\u003c/code\u003e就能unescape\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ereplaceAll\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026amp;quot;\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\\\u0026#34;\u0026#39;\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e如果是長這樣\u003ccode\u003e\u0026quot;{\\\u0026quot;someKey\\\u0026quot;:\\\u0026quot;{\\\u0026quot;nestedKey\\\u0026quot;:\\\u0026quot;nestedValue\\\u0026quot;}\\\u0026quot;}\u0026quot;\u003c/code\u003e的nested object的話，會parse error，需要把{}兩側的引號拿掉\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ereplace\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\\\u0026#34;{\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;{\u0026#39;\u003c/span\u003e).\u003cspan style=\"color:#a6e22e\"\u003ereplace\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;}\\\u0026#34;\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;}\u0026#39;\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e如此就能開心parse了\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u0026gt;\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eJSON\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eparse\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e)\nArray(\u003cspan style=\"color:#ae81ff\"\u003e81\u003c/span\u003e) [ {\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e…\u003c/span\u003e}, {\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e…\u003c/span\u003e}, {\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e…\u003c/span\u003e}, {\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e…\u003c/span\u003e}, {\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e…\u003c/span\u003e}, {\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e…\u003c/span\u003e}, {\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e…\u003c/span\u003e}, {\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e…\u003c/span\u003e}, {\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e…\u003c/span\u003e}, {\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e…\u003c/span\u003e}, \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e…\u003c/span\u003e ]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e",
    "kind": "page",
    "params": {
      "categories": [
        "Web Development"
      ],
      "date": "2021-03-09T09:12:19+08:00",
      "draft": false,
      "iscjklanguage": true,
      "lastmod": "2021-03-09T09:12:19+08:00",
      "publishdate": "2021-03-09T09:12:19+08:00",
      "tags": [
        "Java",
        "Spring",
        "JavaScript"
      ],
      "title": "於Spring輸出可供JS使用之Query result"
    },
    "permalink": "https://mikanbearer.github.io/posts/2021/03/202103090912/index.json",
    "type": "posts",
    "wordcount": 674
  }
}