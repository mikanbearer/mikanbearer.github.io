



    
        
    




{
  "result": {
    "content": "\u003cp\u003e看到大佬這篇\u003ca href=\"https://poshsecurity.com/blog/2014/7/1/sending-syslog-messages-from-powershell.html\" target=\"_blank\"\u003eBLOG\u003c/a\u003e，就突發奇想動手做看看，以後或許能從client取些便利的資料做報告之類的\u003c/p\u003e\n\u003cp\u003e目前原作者已經將這個script已經做成module了(網址：\u003ca href=\"https://github.com/poshsecurity/Posh-SYSLOG\" target=\"_blank\"\u003e\u003ca href=\"https://github.com/poshsecurity/Posh-SYSLOG\"\u003ehttps://github.com/poshsecurity/Posh-SYSLOG\u003c/a\u003e\u003c/a\u003e)\u003c/p\u003e\n\u003cp\u003e但對於目前需求來說，單一個script還是有其優勢在\u003c/p\u003e\n\u003cp\u003e這次的練習主要是這些\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca onclick=\"window.scrollTo({top: document.getElementById(1).offsetTop, behavior: 'smooth'})\"\u003e傳送簡單的UDP Message\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca onclick=\"window.scrollTo({top: document.getElementById(2).offsetTop, behavior: 'smooth'})\"\u003e傳送本機資訊\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca onclick=\"window.scrollTo({top: document.getElementById(3).offsetTop, behavior: 'smooth'})\"\u003e測試\u003c/a\u003e\n\u003cbr\u003e\u003c/br\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e裡面可能不小心混了一點python就別在意\n\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003ch3 id=\"1\"\u003e傳送簡單的UDP Message\u003c/h3\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\n在這裡先捨棄facility與severity改為簡單的udp message\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-ps1\" data-lang=\"ps1\"\u003e\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e SendUDPMessage {\n    \u003cspan style=\"color:#66d9ef\"\u003eParam\u003c/span\u003e (\n        [\u003cspan style=\"color:#66d9ef\"\u003eParameter\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003emandatory\u003c/span\u003e=$true)] \u003cspan style=\"color:#66d9ef\"\u003e[String]\u003c/span\u003e $Server,\n        [\u003cspan style=\"color:#66d9ef\"\u003eParameter\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003emandatory\u003c/span\u003e=$true)] \u003cspan style=\"color:#66d9ef\"\u003e[String]\u003c/span\u003e $Message,\n        [\u003cspan style=\"color:#66d9ef\"\u003eParameter\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003emandatory\u003c/span\u003e=$true)] \u003cspan style=\"color:#66d9ef\"\u003e[int]\u003c/span\u003e $UDPPort\n    )\n \n    \u003cspan style=\"color:#75715e\"\u003e# 建立加密物件\u003c/span\u003e\n    $Encoding = \u003cspan style=\"color:#66d9ef\"\u003e[System.Text.Encoding]\u003c/span\u003e::ASCII\n \n    \u003cspan style=\"color:#75715e\"\u003e# 訊息轉換成byte\u003c/span\u003e\n    $ByteSyslogMessage = $Encoding.GetBytes($Message)\n \n    \u003cspan style=\"color:#75715e\"\u003e# 訊息最長1KB，多的喀擦\u003c/span\u003e\n    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e ($ByteSyslogMessage.Length \u003cspan style=\"color:#f92672\"\u003e-gt\u003c/span\u003e 1024) {\n        $ByteSyslogMessage = $ByteSyslogMessage.SubString(0, 1024)\n    }\n\n    \u003cspan style=\"color:#75715e\"\u003e# Create a UDP Client Object\u003c/span\u003e\n    $UDPCLient = New-Object System.Net.Sockets.UdpClient\n    $UDPCLient.Connect($Server, $UDPPort)\n\n    \u003cspan style=\"color:#75715e\"\u003e# 發送訊息\u003c/span\u003e\n    $UDPCLient.Send($ByteSyslogMessage, $ByteSyslogMessage.Length) \n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e如果配合\u003ca href=\"#/posts/posts%2F2020%2F09%2F202009251338\" target=\"_blank\"\u003e這篇\u003c/a\u003e的練習，就能收到message了\u003c/p\u003e\n\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003ch3 id=\"2\"\u003e使用JSON格式傳送本機資訊\u003c/h3\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\n接下來準備測試用的資料來源，包含可用的windows update及已安裝的套件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-ps1\" data-lang=\"ps1\"\u003e\u003cspan style=\"color:#75715e\"\u003e#取得系統資訊\u003c/span\u003e\n$ComputerInfo = Get-ComputerInfo\n$OsName = $ComputerInfo.OsName\n$OsVersion = $ComputerInfo.OsVersion\n$ProcessorName = $ComputerInfo.CsProcessors.Name\n$MemorySize = $ComputerInfo.CsPhyicallyInstalledMemory / 1024\n\n\u003cspan style=\"color:#75715e\"\u003e#取得Update\u003c/span\u003e\n$UpdateSession = New-Object -ComObject Microsoft.Update.Session\n$UpdateSearcher = $UpdateSession.CreateupdateSearcher()\n$Updates = @($UpdateSearcher.Search(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;IsHidden=0 and IsInstalled=0\u0026#34;\u003c/span\u003e).Updates) | \u003cspan style=\"color:#66d9ef\"\u003eForEach\u003c/span\u003e-Object {$_.Title} | Get-Unique\n\n\u003cspan style=\"color:#75715e\"\u003e#取得Package\u003c/span\u003e\n$InstalledPackage = @(Get-Package) | \u003cspan style=\"color:#66d9ef\"\u003eForEach\u003c/span\u003e-Object {$_.Name} | Get-Unique\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\n之後做成一個符合JSON格式的string\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-ps1\" data-lang=\"ps1\"\u003e\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e SendInfoToUDPServer { \n    \u003cspan style=\"color:#66d9ef\"\u003eParam\u003c/span\u003e (\n        [\u003cspan style=\"color:#66d9ef\"\u003eParameter\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003emandatory\u003c/span\u003e=$true)] \u003cspan style=\"color:#66d9ef\"\u003e[String]\u003c/span\u003e $Server,\n        [\u003cspan style=\"color:#66d9ef\"\u003eParameter\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003emandatory\u003c/span\u003e=$true)] \u003cspan style=\"color:#66d9ef\"\u003e[int]\u003c/span\u003e $UDPPort\n    )\n\n    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (($Hostname \u003cspan style=\"color:#f92672\"\u003e-eq\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e-or\u003c/span\u003e ($Hostname \u003cspan style=\"color:#f92672\"\u003e-eq\u003c/span\u003e $null))\n    {\n        $Hostname = Hostname\n    }\n\n    \u003cspan style=\"color:#75715e\"\u003e#取得系統資訊\u003c/span\u003e\n    $ComputerInfo = Get-ComputerInfo\n    $OsName = $ComputerInfo.OsName\n    $OsVersion = $ComputerInfo.OsVersion\n    $ProcessorName = $ComputerInfo.CsProcessors.Name\n    $MemorySize = $ComputerInfo.CsPhyicallyInstalledMemory / 1024\n\n    \u003cspan style=\"color:#75715e\"\u003e#傳送系統資訊\u003c/span\u003e\n    SendUDPMessage $Server \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;{\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ehost\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e$Hostname\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ename\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003eOsName\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003evalue\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e$OsName\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u0026#34;\u003c/span\u003e $UDPPort\n    SendUDPMessage $Server \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;{\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ehost\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e$Hostname\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ename\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003eOsVersion\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003evalue\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e$OsVersion\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u0026#34;\u003c/span\u003e $UDPPort\n    SendUDPMessage $Server \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;{\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ehost\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e$Hostname\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ename\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003eProcessorName\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003evalue\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e$ProcessorName\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u0026#34;\u003c/span\u003e $UDPPort\n    SendUDPMessage $Server \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;{\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ehost\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e$Hostname\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ename\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003eMemorySize\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003evalue\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e$MemorySize\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u0026#34;\u003c/span\u003e $UDPPort\n    \n    \u003cspan style=\"color:#75715e\"\u003e#取得Update\u003c/span\u003e\n    $UpdateSession = New-Object -ComObject Microsoft.Update.Session\n    $UpdateSearcher = $UpdateSession.CreateupdateSearcher()\n    $Updates = @($UpdateSearcher.Search(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;IsHidden=0 and IsInstalled=0\u0026#34;\u003c/span\u003e).Updates) | \u003cspan style=\"color:#66d9ef\"\u003eForEach\u003c/span\u003e-Object {$_.Title} | Get-Unique\n\n    \u003cspan style=\"color:#75715e\"\u003e#傳送Update\u003c/span\u003e\n    \u003cspan style=\"color:#66d9ef\"\u003eforeach\u003c/span\u003e ($i \u003cspan style=\"color:#66d9ef\"\u003ein\u003c/span\u003e $Updates)\n    {\n        SendUDPMessage $Server \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;{\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ehost\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e$Hostname\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ename\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003eupdate\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003evalue\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e$i\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u0026#34;\u003c/span\u003e $UDPPort\n    }\n    \n    \u003cspan style=\"color:#75715e\"\u003e#取得Package\u003c/span\u003e\n    $InstalledPackage = @(Get-Package) | \u003cspan style=\"color:#66d9ef\"\u003eForEach\u003c/span\u003e-Object {$_.Name} | Get-Unique\n\n    \u003cspan style=\"color:#75715e\"\u003e#傳送Package\u003c/span\u003e\n    \u003cspan style=\"color:#66d9ef\"\u003eforeach\u003c/span\u003e ($i \u003cspan style=\"color:#66d9ef\"\u003ein\u003c/span\u003e $InstalledPackage)\n    {        \n        SendUDPMessage $Server \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;{\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ehost\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e$Hostname\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ename\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003epackage\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003evalue\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e$i\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e`\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u0026#34;\u003c/span\u003e $UDPPort\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003ecall剛才的function就能送訊息出去了\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-ps1\" data-lang=\"ps1\"\u003eSendInfoToUDPServer 127.0.0.1 514\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003ch3 id=\"3\"\u003e測試\u003c/h3\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\n接著就能進行測試，看看parse json是否成功\u003c/p\u003e\n\u003cp\u003e可用一個小小的powershell script測試\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-ps1\" data-lang=\"ps1\"\u003e$port = 514\n$endpoint = New-Object System.Net.IPEndPoint (\u003cspan style=\"color:#66d9ef\"\u003e[IPAddress]\u003c/span\u003e::Any, $port)\n\u003cspan style=\"color:#66d9ef\"\u003eTry\u003c/span\u003e {\n    \u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e($true) {\n        $socket = New-Object System.Net.Sockets.UdpClient $port\n        $content = $socket.Receive(\u003cspan style=\"color:#66d9ef\"\u003e[ref]\u003c/span\u003e$endpoint)\n        $socket.Close()\n        $text = \u003cspan style=\"color:#66d9ef\"\u003e[Text.Encoding]\u003c/span\u003e::ASCII.GetString($content)\n        $text | ConvertFrom-Json\n    }\n} \u003cspan style=\"color:#66d9ef\"\u003eCatch\u003c/span\u003e {\n    \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$($Error[0])\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\n輸出會是這樣\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ehost        name   value\n----        ----   -----\nPC1 OsName Microsoft Windows 10 ???\nPC1 update ????? x64 ???? Windows 10 Version 2004 Adobe Flash Player (KB4577586)\nPC1 update Realtek - Net - 10/3/2017 12:00:00 AM - 10.23.1003.2017\nPC1 update Realtek Semiconductor Corp. - USB - 5/22/2018 12:00:00 AM - 10.0.1...\nPC1 update ELAN - Mouse - 10/19/2017 12:00:00 AM - 19.4.7.3\nPC1 update Realtek Semiconductor Corp. - MEDIA - 10/16/2018 12:00:00 AM - 6.0...\nPC1 update Intel - System - 9/19/2017 12:00:00 AM - 11.7.0.1000\nPC1 update INTEL - System - 7/18/1968 12:00:00 AM - 10.1.1.45\nPC1 update NVIDIA - Display - 26.21.14.3630\nPC1 update Intel Corporation - System - 2.10.100.2\nPC1 update Intel Corporation - SoftwareComponent - 2.11.100.3\nPC1 update Lenovo - System - 15.11.29.61\nPC1 pac... 7-Zip 18.01 (x64)\nPC1 pac... EPSON LABELWORKS Printer Driver\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e或使用這個\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-:SimpleTestServer.py\" data-lang=\":SimpleTestServer.py\"\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e socketserver \u003cspan style=\"color:#f92672\"\u003eas\u003c/span\u003e SocketServer\n\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e json\n\nHOST, PORT \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;0.0.0.0\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e514\u003c/span\u003e\n\n\u003cspan style=\"color:#66d9ef\"\u003eclass\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eSyslogUDPHandler\u003c/span\u003e(SocketServer\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eBaseRequestHandler):\n\n\t\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehandle\u003c/span\u003e(self):\n\t\tdata \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bytes\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode(self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erequest[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estrip())\n\t\t\u003cspan style=\"color:#66d9ef\"\u003eprint\u003c/span\u003e(json\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eloads(str(data)))\n\n\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e __name__ \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;__main__\u0026#39;\u003c/span\u003e:\n\t\u003cspan style=\"color:#66d9ef\"\u003etry\u003c/span\u003e:\n\t\tserver \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e SocketServer\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eUDPServer((HOST,PORT), SyslogUDPHandler)\n\t\tserver\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eserve_forever(poll_interval\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0.5\u003c/span\u003e)\n\t\u003cspan style=\"color:#66d9ef\"\u003eexcept\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eIOError\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eSystemExit\u003c/span\u003e):\n\t\t\u003cspan style=\"color:#66d9ef\"\u003eraise\u003c/span\u003e\n\t\u003cspan style=\"color:#66d9ef\"\u003eexcept\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eKeyboardInterrupt\u003c/span\u003e:\n\t\t\u003cspan style=\"color:#66d9ef\"\u003eprint\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Crtl+C Pressed. Shutting down.\u0026#39;\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\n大概會得到這樣的輸出\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e{'host': 'PC1', 'name': 'OsName', 'value': 'Microsoft Windows 10 ???'}\n{'host': 'PC1', 'name': 'OsVersion', 'value': '10.0.19041'}\n{'host': 'PC1', 'name': 'ProcessorName', 'value': 'Intel(R) Core(TM) i5-8250U CPU @ 1.60GHz'}\n{'host': 'PC1', 'name': 'MemorySize', 'value': '8192'}\n{'host': 'PC1', 'name': 'update', 'value': '????? x64 ???? Windows 10 Version 2004 Adobe Flash Player (KB4577586)'}\n{'host': 'PC1', 'name': 'update', 'value': 'Microsoft Defender Antivirus ?????? - KB2267602 ??? 1.331.1559.0?'}\n{'host': 'PC1', 'name': 'update', 'value': 'Realtek - Net - 10/3/2017 12:00:00 AM - 10.23.1003.2017'}\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e",
    "kind": "page",
    "params": {
      "categories": [
        "Tricks"
      ],
      "date": "2021-02-20T15:02:08+08:00",
      "draft": false,
      "iscjklanguage": true,
      "lastmod": "2021-02-20T15:02:08+08:00",
      "publishdate": "2021-02-20T15:02:08+08:00",
      "tags": [
        "PowerShell",
        "Windows"
      ],
      "title": "透過PowerShell傳送JSON格式的UDP Message"
    },
    "permalink": "https://mikanbearer.github.io/posts/202102201502/index.json",
    "type": "posts",
    "wordcount": 1022
  }
}