



    
        
    




{
  "result": {
    "content": "\u003cp\u003e\u003ca href=\"https://stackoverflow.com/questions/8841502/how-to-use-the-request-in-a-modelform-in-django\" target=\"_blank\"\u003e這裡\u003c/a\u003e看到的，覺得是不錯的方法，怕忘記所以筆記一下\u003c/p\u003e\n\u003cp\u003e建立一個Mixin，繼承\u003ccode\u003eget_form_kwargs()\u003c/code\u003e，用途是把request偷偷塞進form用的kwargs\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-:views.py\" data-lang=\":views.py\"\u003e\u003cspan style=\"color:#f92672\"\u003e...\u003c/span\u003e\n\u003cspan style=\"color:#66d9ef\"\u003eclass\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ePassRequestToFormViewMixin\u003c/span\u003e:\n    \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eget_form_kwargs\u003c/span\u003e(self):\n        kwargs \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e super()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eget_form_kwargs()\n        kwargs[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;request\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erequest\n        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e kwargs\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e使用這個Mixin的view，以CreateView示範\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-:views.py\" data-lang=\":views.py\"\u003e\u003cspan style=\"color:#f92672\"\u003e...\u003c/span\u003e\n\u003cspan style=\"color:#66d9ef\"\u003eclass\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eSomeCreateView\u003c/span\u003e(PassRequestToFormViewMixin, CreateView):\n    form_class \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e SomeForm\n    template_name \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;main/form.html\u0026#39;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e接著在\u003ccode\u003e__init__()\u003c/code\u003e的時候把剛才偷塞的request從kwargs中抽出就行了\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-:forms.py\" data-lang=\":forms.py\"\u003e\u003cspan style=\"color:#66d9ef\"\u003eclass\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eSomeForm\u003c/span\u003e(forms\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eModelForm):\n    \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e __init__(self, \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003eargs, \u003cspan style=\"color:#f92672\"\u003e**\u003c/span\u003ekwargs):\n        self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erequest \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e kwargs\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epop(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;request\u0026#39;\u003c/span\u003e)\n        super()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e__init__(\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003eargs, \u003cspan style=\"color:#f92672\"\u003e**\u003c/span\u003ekwargs)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e以下為簡易的情境應用，將\u003ccode\u003erequese.user\u003c/code\u003e寫入publisher這個field\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\n\u003ctable style=\"border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;\"\u003e\u003ctr\u003e\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 1\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 2\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 3\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 4\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 5\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 6\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 7\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 8\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 9\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e10\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e11\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e12\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e13\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e14\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;;width:100%\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-:views.py\" data-lang=\":views.py\"\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e django.views.generic \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e CreateView\n\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e .models \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e SomeModel\n\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e .forms \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e SomeForm\n\n\n\u003cspan style=\"color:#66d9ef\"\u003eclass\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ePassRequestToFormViewMixin\u003c/span\u003e:\n    \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eget_form_kwargs\u003c/span\u003e(self):\n        kwargs \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e super()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eget_form_kwargs()\n        kwargs[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;request\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erequest\n        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e kwargs\n\n\u003cspan style=\"color:#66d9ef\"\u003eclass\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eSomeCreateView\u003c/span\u003e(PassRequestToFormViewMixin, CreateView):\n    form_class \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e SomeForm\n    template_name \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;someapp/form.html\u0026#39;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\n\u003ctable style=\"border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;\"\u003e\u003ctr\u003e\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 1\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 2\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 3\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 4\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 5\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 6\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 7\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 8\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 9\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e10\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e11\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e12\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e13\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;;width:100%\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-:forms.py\" data-lang=\":forms.py\"\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e django \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e forms\n\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e .models \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e CustomUser, Organization\n\n\n\u003cspan style=\"color:#66d9ef\"\u003eclass\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eSomeForm\u003c/span\u003e(forms\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eModelForm):\n    \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e __init__(self, \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003eargs, \u003cspan style=\"color:#f92672\"\u003e**\u003c/span\u003ekwargs):\n        self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erequest \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e kwargs\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epop(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;request\u0026#39;\u003c/span\u003e)\n        super()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e__init__(\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003eargs, \u003cspan style=\"color:#f92672\"\u003e**\u003c/span\u003ekwargs)\n\n    \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esave\u003c/span\u003e(self, commit\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eTrue):\n        self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epublisher \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erequest\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003euser\n        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e super()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esave(commit\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ecommit)\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e",
    "kind": "page",
    "params": {
      "categories": [
        "Web Development"
      ],
      "date": "2020-12-21T11:36:22+08:00",
      "draft": false,
      "iscjklanguage": true,
      "lastmod": "2020-12-21T11:36:22+08:00",
      "publishdate": "2020-12-21T11:36:22+08:00",
      "tags": [
        "Django",
        "Python"
      ],
      "title": "在Forms中調用request"
    },
    "permalink": "https://mikanbearer.github.io/posts/202012211136/index.json",
    "type": "posts",
    "wordcount": 315
  }
}