



    
        
    




{
  "result": {
    "content": "\u003cp\u003e這次練習的OpenResty是基於Nginx與Lua的Web Platform，不太熟悉所以先摸摸看再說\u003c/p\u003e\n\u003cp\u003e主要參照官方文件：\u003ca href=\"https://openresty.org/en/getting-started.html\" target=\"_blank\"\u003e傳送門\u003c/a\u003e\n\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003ch3 id=\"建立環境\"\u003e建立環境\u003c/h3\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e環境是CentOS 7\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# cat /etc/*-release\nCentOS Linux release 7.7.1908 (Core)\nNAME=\u0026quot;CentOS Linux\u0026quot;\nVERSION=\u0026quot;7 (Core)\u0026quot;\nID=\u0026quot;centos\u0026quot;\nID_LIKE=\u0026quot;rhel fedora\u0026quot;\nVERSION_ID=\u0026quot;7\u0026quot;\nPRETTY_NAME=\u0026quot;CentOS Linux 7 (Core)\u0026quot;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e安裝必要的package(需加repo)\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# yum-config-manager --add-repo https://openresty.org/package/centos/openresty.repo\n# yum install openresy openresty-resty openresty-opm\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e可以使用resty指令執行lua code\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$ resty -e 'print(\u0026quot;hello, world\u0026quot;)'\n\nhello, world\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003ch3 id=\"啟動nginx\"\u003e啟動Nginx\u003c/h3\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e接著要啟動Nginx，首先建立要使用的目錄\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$ mkdir ~/work\n$ cd ~/work\n$ mkdir logs/ conf/\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e建立第一個config，response使用lua code\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\n\u003ctable style=\"border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;\"\u003e\u003ctr\u003e\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 1\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 2\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 3\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 4\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 5\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 6\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 7\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 8\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 9\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e10\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e11\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e12\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e13\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e14\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e15\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e16\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;;width:100%\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-conf/nginx.conf\" data-lang=\"conf/nginx.conf\"\u003e\u003cspan style=\"color:#66d9ef\"\u003eworker_processes\u003c/span\u003e  \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e;\n\u003cspan style=\"color:#66d9ef\"\u003eerror_log\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003elogs/error.log\u003c/span\u003e;\n\u003cspan style=\"color:#66d9ef\"\u003eevents\u003c/span\u003e {\n    \u003cspan style=\"color:#f92672\"\u003eworker_connections\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1024\u003c/span\u003e;\n}\n\u003cspan style=\"color:#66d9ef\"\u003ehttp\u003c/span\u003e {\n    \u003cspan style=\"color:#f92672\"\u003eserver\u003c/span\u003e {\n        \u003cspan style=\"color:#f92672\"\u003elisten\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e8080\u003c/span\u003e;\n        \u003cspan style=\"color:#f92672\"\u003elocation\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e/\u003c/span\u003e {\n            \u003cspan style=\"color:#f92672\"\u003edefault_type\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003etext/html\u003c/span\u003e;\n            \u003cspan style=\"color:#f92672\"\u003econtent_by_lua_block\u003c/span\u003e {\n                \u003cspan style=\"color:#f92672\"\u003engx.say(\u0026#34;\u0026lt;p\u0026gt;hello,\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eworld\u0026lt;/p\u0026gt;\u0026#34;)\u003c/span\u003e\n            \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e}\u003c/span\u003e\n        \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e}\u003c/span\u003e\n    \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e}\u003c/span\u003e\n\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e為了方便使用把nginx加到\u003ccode\u003e$PATH\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eexport PATH=/usr/local/openresty/nginx/sbin:$PATH\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e使用nginx指令，conf檔指向剛才建立好的nginx.conf\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# nginx -p `pwd`/ -c conf/nginx.conf\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e也能使用以下指令stop或reload\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# nginx -p $(pwd) -s stop\n# nginx -p $(pwd) -s reload \n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\n使用cURL測試\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$ curl http://localhost:8080/\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e如此就能看到response了\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-html\" data-lang=\"html\"\u003e\u0026lt;\u003cspan style=\"color:#f92672\"\u003ep\u003c/span\u003e\u0026gt;hello, world\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ep\u003c/span\u003e\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003ch3 id=\"routing執行外部lua-file\"\u003eRouting執行外部Lua file\u003c/h3\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\n接下來建立一個.lua來測試\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-:lua/hello_world.lua\" data-lang=\":lua/hello_world.lua\"\u003engx.say(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026lt;p\u0026gt;Hello from My Lua file\u0026lt;/p\u0026gt;\u0026#34;\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e執行.lua需要權限，所以conf必須指定user，否則會permission denied\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\n\u003ctable style=\"border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;\"\u003e\u003ctr\u003e\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 1\n\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 2\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 3\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 4\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 5\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 6\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 7\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 8\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 9\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e10\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e11\n\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e12\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e13\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e14\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e15\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;;width:100%\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-conf/nginx.conf\" data-lang=\"conf/nginx.conf\"\u003e\u003cspan style=\"color:#66d9ef\"\u003eworker_processes\u003c/span\u003e  \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e;\n\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"color:#66d9ef\"\u003euser\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eroot\u003c/span\u003e; \u003cspan style=\"color:#75715e\"\u003e# 指定user\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eerror_log\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003elogs/error.log\u003c/span\u003e;\n\u003cspan style=\"color:#66d9ef\"\u003eevents\u003c/span\u003e {\n    \u003cspan style=\"color:#f92672\"\u003eworker_connections\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1024\u003c/span\u003e;\n}\n\u003cspan style=\"color:#66d9ef\"\u003ehttp\u003c/span\u003e {\n    \u003cspan style=\"color:#f92672\"\u003eserver\u003c/span\u003e {\n        \u003cspan style=\"color:#f92672\"\u003elisten\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e8080\u003c/span\u003e;\n        \u003cspan style=\"color:#f92672\"\u003elocation\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e/\u003c/span\u003e {\n            \u003cspan style=\"color:#f92672\"\u003edefault_type\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003etext/html\u003c/span\u003e;\n\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e            \u003cspan style=\"color:#f92672\"\u003econtent_by_lua_file\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e./lua/hello_world.lua\u003c/span\u003e; \u003cspan style=\"color:#75715e\"\u003e# 目標.lua\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e        }\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e記得reload\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# nginx -p $(pwd) -s reload \n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e就能執行檔案內的lua code了\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$ curl localhost:8080\n\u0026lt;p\u0026gt;Hello from My Lua file\u0026lt;/p\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e基本操作就是這樣，雖然對Lua的未來有點擔憂，但OpenResty還挺好用的，雖然還沒體會到其真正厲害之處，有空再繼續練習吧\u003c/p\u003e",
    "kind": "page",
    "params": {
      "categories": [
        "Operation"
      ],
      "date": "2020-12-16T11:28:38+08:00",
      "draft": false,
      "iscjklanguage": true,
      "lastmod": "2020-12-16T11:28:38+08:00",
      "publishdate": "2020-12-16T11:28:38+08:00",
      "tags": [
        "Nginx",
        "Lua",
        "OpenResty"
      ],
      "title": "OpenResty初體驗"
    },
    "permalink": "https://mikanbearer.github.io/posts/202012161128/index.json",
    "type": "posts",
    "wordcount": 608
  }
}