



    
        
    




{
  "result": {
    "content": "\u003cp\u003e想特地找個一個有自帶plugin的軟體練習一下幫助記憶，剛剛好是常常使用RabbitMQ！這次就來測試看看，當作實務運用的練習\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/rabbitmq/rabbitmq-prometheus\"\u003erabbitmq-prometheus的repository\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e一樣求方便使用docker-compose，寫個陽春的Dockerfile會比較方便\u003c/p\u003e\n\u003cp\u003e為了使用內建的pulgin，直接用3.8.0以後的image，並且RUN啟用的command\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-Dockerfile\" data-lang=\"Dockerfile\"\u003e\u003cspan style=\"color:#66d9ef\"\u003eFROM\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e rabbitmq:3.8.6-management\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\n\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eRUN\u003c/span\u003e rabbitmq-plugins enable rabbitmq_prometheus\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\ncompose file增加port 15692\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\n\u003ctable style=\"border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;\"\u003e\u003ctr\u003e\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 1\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 2\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 3\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 4\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 5\n\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 6\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 7\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 8\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 9\n\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e10\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e11\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e12\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e13\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e14\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e15\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;;width:100%\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-:docker-compose.yml\" data-lang=\":docker-compose.yml\"\u003e\u003cspan style=\"color:#f92672\"\u003eversion\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;3\u0026#39;\u003c/span\u003e\n\n\u003cspan style=\"color:#f92672\"\u003eservices\u003c/span\u003e:\n  \u003cspan style=\"color:#f92672\"\u003emy-queue\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003econtainer_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003erabbitmq\u003c/span\u003e\n\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e    \u003cspan style=\"color:#f92672\"\u003ebuild\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e./\u003c/span\u003e\n\u003c/span\u003e    \u003cspan style=\"color:#f92672\"\u003eports\u003c/span\u003e:\n      - \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;5672:5672\u0026#39;\u003c/span\u003e\n      - \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;15672:15672\u0026#39;\u003c/span\u003e\n\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e      - \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;15692:15692\u0026#39;\u003c/span\u003e\n\u003c/span\u003e    \u003cspan style=\"color:#f92672\"\u003evolumes\u003c/span\u003e:\n      - \u003cspan style=\"color:#ae81ff\"\u003erabbitmq-data:/var/lib/rabbitmq\u003c/span\u003e\n\n\u003cspan style=\"color:#f92672\"\u003evolumes\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003erabbitmq-data\u003c/span\u003e:\n\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\n接下來就能在host上用cURL測試了\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$ curl -v -H \u0026quot;Accept:text/plain\u0026quot; \u0026quot;http://localhost:15692/metrics\u0026quot;\r\n...\r\n# TYPE rabbitmq_consumers gauge\r\n# HELP rabbitmq_consumers Consumers currently connected\r\nrabbitmq_consumers 0\r\n# TYPE rabbitmq_queues gauge\r\n# HELP rabbitmq_queues Queues available\r\nrabbitmq_queues 0\r\n# TYPE rabbitmq_build_info untyped\r\n# HELP rabbitmq_build_info RabbitMQ \u0026amp; Erlang/OTP version info\r\nrabbitmq_build_info{rabbitmq_version=\u0026quot;3.8.6\u0026quot;,prometheus_plugin_version=\u0026quot;3.8.6\u0026quot;,prometheus_client_version=\u0026quot;4.6.0\u0026quot;,erlang_version=\u0026quot;23.0.3\u0026quot;} 1\r\n# TYPE rabbitmq_identity_info untyped\r\n# HELP rabbitmq_identity_info RabbitMQ node \u0026amp; cluster identity info\r\nrabbitmq_identity_info{rabbitmq_node=\u0026quot;rabbit@7f33446fce98\u0026quot;,rabbitmq_cluster=\u0026quot;rabbit@7f33446fce98\u0026quot;} 1\r\n# TYPE telemetry_scrape_duration_seconds summary\r\n# HELP telemetry_scrape_duration_seconds Scrape duration\r\n# TYPE telemetry_scrape_size_bytes summary\r\n# HELP telemetry_scrape_size_bytes Scrape size, not encoded\r\n# TYPE telemetry_scrape_encoded_size_bytes summary\r\n...\r\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e巴拉巴拉一大堆\n\u003cbr\u003e\u003c/br\u003e\n適當增加一下prometheus的config，反正只是測試一下，就姑且用static config吧\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan style=\"color:#f92672\"\u003escrape_configs\u003c/span\u003e:\n...\n  - \u003cspan style=\"color:#f92672\"\u003ejob_name\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;rabbitmq-exporter\u0026#39;\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003escrape_interval\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e60s\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003escrape_timeout\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e59s\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003estatic_configs\u003c/span\u003e:\n      - \u003cspan style=\"color:#f92672\"\u003etargets\u003c/span\u003e:\n          - \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;rabbitmq-exporter:15692\u0026#39;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\n能看到endpoint增加了\n\u003cimg src=\"1.png\" alt=\"\"\u003e\n\u003cbr\u003e\u003c/br\u003e\n\u003cimg src=\"2.png\" alt=\"\"\u003e\n這樣就能用Prometheus監控RabbitMQ了\u003c/p\u003e\n\u003cp\u003e剩下細部的設定可以參考\u003ca href=\"https://www.rabbitmq.com/prometheus.html\"\u003ehttps://www.rabbitmq.com/prometheus.html\u003c/a\u003e\u003c/p\u003e",
    "kind": "page",
    "params": {
      "categories": [
        "Monitoring"
      ],
      "date": "2020-08-18T16:09:08+08:00",
      "draft": false,
      "iscjklanguage": true,
      "lastmod": "2020-08-18T16:09:08+08:00",
      "publishdate": "2020-08-18T16:09:08+08:00",
      "tags": [
        "Prometheus",
        "RabbitMQ"
      ],
      "title": "【Prometheus入門練習-基本操作篇3】使用Prometheus監控RabbitMQ"
    },
    "permalink": "https://mikanbearer.github.io/posts/2020/08/202008181609/index.json",
    "type": "posts",
    "wordcount": 497
  }
}