<p>工作中常常用到的功能，不筆記會忘記，
主要是在Excel Macro調用Wshshell，把A欄的結果輸出到B欄</p>
<p>nslookup範例</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vb" data-lang="vb"><span style="color:#66d9ef">Sub</span> <span style="color:#a6e22e">nslookup</span>()
    <span style="color:#66d9ef">Dim</span> WshShell, wExec, cmd, rRes, i, j
    <span style="color:#66d9ef">Dim</span> sBuf() <span style="color:#f92672">As</span> <span style="color:#66d9ef">String</span>

    <span style="color:#66d9ef">Set</span> WshShell <span style="color:#f92672">=</span> CreateObject(<span style="color:#e6db74">&#34;WScript.Shell&#34;</span>)
    <span style="color:#66d9ef">For</span> i <span style="color:#f92672">=</span> 1 <span style="color:#66d9ef">To</span> 3
        <span style="color:#66d9ef">Set</span> wExec <span style="color:#f92672">=</span> WshShell.exec(<span style="color:#e6db74">&#34;nslookup &#34;</span> <span style="color:#f92672">&amp;</span> Cells(i, 1))

        <span style="color:#66d9ef">Do</span> <span style="color:#66d9ef">While</span> wExec.Status <span style="color:#f92672">=</span> 0
            DoEvents
        <span style="color:#66d9ef">Loop</span>
        rRes <span style="color:#f92672">=</span> wExec.StdOut.ReadAll
        sBuf <span style="color:#f92672">=</span> Split(rRes, vbCrLf)
        <span style="color:#66d9ef">For</span> j <span style="color:#f92672">=</span> 0 <span style="color:#66d9ef">To</span> UBound(sBuf)
            <span style="color:#66d9ef">If</span> Left(sBuf(j), 5) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Name:&#34;</span> <span style="color:#f92672">Or</span> Left(sBuf(j), 3) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;名稱:&#34;</span> <span style="color:#66d9ef">Then</span>
                Cells(i, 2) <span style="color:#f92672">=</span> Trim(Right(sBuf(j), Len(sBuf(j)) <span style="color:#f92672">-</span> 5))
            <span style="color:#66d9ef">End</span> <span style="color:#66d9ef">If</span>
        <span style="color:#66d9ef">Next</span> j
    <span style="color:#66d9ef">Next</span> i
<span style="color:#66d9ef">End</span> <span style="color:#66d9ef">Sub</span>
</code></pre></div><p>ping的範例</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vb" data-lang="vb"><span style="color:#66d9ef">Sub</span> <span style="color:#a6e22e">ping</span>()
    <span style="color:#66d9ef">Dim</span> WshShell, wExec, cmd, rRes, i, j
    <span style="color:#66d9ef">Dim</span> sBuf() <span style="color:#f92672">As</span> <span style="color:#66d9ef">String</span>

    <span style="color:#66d9ef">Set</span> WshShell <span style="color:#f92672">=</span> CreateObject(<span style="color:#e6db74">&#34;WScript.Shell&#34;</span>)
    <span style="color:#66d9ef">For</span> i <span style="color:#f92672">=</span> 1 <span style="color:#66d9ef">To</span> 3
        <span style="color:#66d9ef">Set</span> wExec <span style="color:#f92672">=</span> WshShell.exec(<span style="color:#e6db74">&#34;ping &#34;</span> <span style="color:#f92672">&amp;</span> Cells(i, 1))

        <span style="color:#66d9ef">Do</span> <span style="color:#66d9ef">While</span> wExec.Status <span style="color:#f92672">=</span> 0
            DoEvents
        <span style="color:#66d9ef">Loop</span>
        rRes <span style="color:#f92672">=</span> wExec.StdOut.ReadAll
        <span style="color:#66d9ef">If</span> InStr(rRes, <span style="color:#e6db74">&#34;TTL&#34;</span>) <span style="color:#66d9ef">Then</span>
            Cells(i, 2) <span style="color:#f92672">=</span> 1
        <span style="color:#66d9ef">Else</span>
            Cells(i, 2) <span style="color:#f92672">=</span> 0
        <span style="color:#66d9ef">End</span> <span style="color:#66d9ef">If</span>
        
    <span style="color:#66d9ef">Next</span> i
<span style="color:#66d9ef">End</span> <span style="color:#66d9ef">Sub</span>
</code></pre></div>


<v-card class="mt-5 content">
  <v-card-text>
  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "mikanmimi" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </v-card-text>
</v-card>
