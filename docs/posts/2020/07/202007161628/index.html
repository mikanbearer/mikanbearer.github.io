<p>這次作為複習，利用djangorestframework製作一個陽春的REST API
何謂RESTful就不贅述了，直接開始實做</p>
<p>code放在一樣放在GitHub上
<a href="https://github.com/mikanbearer/django_rest_example">https://github.com/mikanbearer/django_rest_example</a></p>
<p>環境大概是以下這樣</p>
<pre><code>$ python --version
Python 3.8.4
$ pip list
...
Django                  3.0
djangorestframework     3.11.0
</code></pre><p>初期的幾個指令</p>
<pre><code>django-admin startproject django_rest_example
cd django_rest_example
python manage.py startapp api
python manage.py migrate
</code></pre><p>完成後的樹狀圖</p>
<pre><code>.
│  db.sqlite3
│  manage.py
│
├─django_rest_example
│  │  asgi.py
│  │  settings.py
│  │  urls.py
│  │  wsgi.py
│  │  __init__.py
│  │
│  └─__pycache__
│          settings.cpython-36.pyc
│          urls.cpython-36.pyc
│          __init__.cpython-36.pyc
│
└─api
    │  admin.py
    │  apps.py
    │  models.py
    │  tests.py
    │  views.py
    │  __init__.py
    │
    ├─migrations
    │      __init__.py
    │
    └─__pycache__
            __init__.cpython-36.pyc

</code></pre><p>settings.py追加剛才建立的app</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-:django_rest_example/settings.py" data-lang=":django_rest_example/settings.py">
INSTALLED_APPS <span style="color:#f92672">=</span> [
    <span style="color:#e6db74">&#39;django.contrib.admin&#39;</span>,
    <span style="color:#e6db74">&#39;django.contrib.auth&#39;</span>,
    <span style="color:#e6db74">&#39;django.contrib.contenttypes&#39;</span>,
    <span style="color:#e6db74">&#39;django.contrib.sessions&#39;</span>,
    <span style="color:#e6db74">&#39;django.contrib.messages&#39;</span>,
    <span style="color:#e6db74">&#39;django.contrib.staticfiles&#39;</span>,
<span style="display:block;width:100%;background-color:#3c3d38">    <span style="color:#e6db74">&#39;rest_framework&#39;</span>, <span style="color:#75715e"># 追加</span>
</span><span style="display:block;width:100%;background-color:#3c3d38">    <span style="color:#e6db74">&#39;api&#39;</span>, <span style="color:#75715e"># 追加</span>
</span>]

</code></pre></td></tr></table>
</div>
</div><p>追加以下設定，可以指定一頁最多幾個object</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span></span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-:django_rest_example/settings.py" data-lang=":django_rest_example/settings.py">
<span style="display:block;width:100%;background-color:#3c3d38">REST_FRAMEWORK <span style="color:#f92672">=</span> {
</span><span style="display:block;width:100%;background-color:#3c3d38">    <span style="color:#e6db74">&#39;DEFAULT_PAGINATION_CLASS&#39;</span>: <span style="color:#e6db74">&#39;rest_framework.pagination.PageNumberPagination&#39;</span>,
</span><span style="display:block;width:100%;background-color:#3c3d38">    <span style="color:#e6db74">&#39;PAGE_SIZE&#39;</span>: <span style="color:#ae81ff">10</span>
</span><span style="display:block;width:100%;background-color:#3c3d38">}
</span></code></pre></td></tr></table>
</div>
</div><p>修改models.py</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span></span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-:api/models.py" data-lang=":api/models.py"><span style="color:#f92672">from</span> django.db <span style="color:#f92672">import</span> models
<span style="display:block;width:100%;background-color:#3c3d38"><span style="color:#f92672">from</span> django.core <span style="color:#f92672">import</span> validators
</span>
<span style="color:#75715e"># Create your models here.</span>
<span style="display:block;width:100%;background-color:#3c3d38"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Linkman</span>(models<span style="color:#f92672">.</span>Model):
</span><span style="display:block;width:100%;background-color:#3c3d38">    SEX_CHOICES <span style="color:#f92672">=</span> (
</span><span style="display:block;width:100%;background-color:#3c3d38">        (<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;男&#39;</span>),
</span><span style="display:block;width:100%;background-color:#3c3d38">        (<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;女&#39;</span>),
</span><span style="display:block;width:100%;background-color:#3c3d38">    )
</span><span style="display:block;width:100%;background-color:#3c3d38">
</span><span style="display:block;width:100%;background-color:#3c3d38">    name <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>CharField(
</span><span style="display:block;width:100%;background-color:#3c3d38">        verbose_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;姓名&#39;</span>,
</span><span style="display:block;width:100%;background-color:#3c3d38">        max_length<span style="color:#f92672">=</span><span style="color:#ae81ff">15</span>
</span><span style="display:block;width:100%;background-color:#3c3d38">    )
</span><span style="display:block;width:100%;background-color:#3c3d38">
</span><span style="display:block;width:100%;background-color:#3c3d38">    sex <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>IntegerField(
</span><span style="display:block;width:100%;background-color:#3c3d38">        verbose_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;性別&#39;</span>,
</span><span style="display:block;width:100%;background-color:#3c3d38">        choices<span style="color:#f92672">=</span>SEX_CHOICES,
</span><span style="display:block;width:100%;background-color:#3c3d38">        default<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span><span style="display:block;width:100%;background-color:#3c3d38">    )
</span><span style="display:block;width:100%;background-color:#3c3d38">
</span><span style="display:block;width:100%;background-color:#3c3d38">    tel <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>CharField(
</span><span style="display:block;width:100%;background-color:#3c3d38">        verbose_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;電話&#39;</span>,
</span><span style="display:block;width:100%;background-color:#3c3d38">        max_length<span style="color:#f92672">=</span><span style="color:#ae81ff">15</span>
</span><span style="display:block;width:100%;background-color:#3c3d38">    )
</span><span style="display:block;width:100%;background-color:#3c3d38">
</span><span style="display:block;width:100%;background-color:#3c3d38">    email <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>EmailField(
</span><span style="display:block;width:100%;background-color:#3c3d38">        verbose_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;電子郵件&#39;</span>,
</span><span style="display:block;width:100%;background-color:#3c3d38">        validators<span style="color:#f92672">=</span>[validators<span style="color:#f92672">.</span>EmailValidator]
</span><span style="display:block;width:100%;background-color:#3c3d38">    )
</span><span style="display:block;width:100%;background-color:#3c3d38">
</span><span style="display:block;width:100%;background-color:#3c3d38">    created_at <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>DateTimeField(
</span><span style="display:block;width:100%;background-color:#3c3d38">        verbose_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;建立日&#39;</span>,
</span><span style="display:block;width:100%;background-color:#3c3d38">        auto_now_add<span style="color:#f92672">=</span>True
</span><span style="display:block;width:100%;background-color:#3c3d38">    )
</span><span style="display:block;width:100%;background-color:#3c3d38">
</span><span style="display:block;width:100%;background-color:#3c3d38">    updated_at <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>DateTimeField(
</span><span style="display:block;width:100%;background-color:#3c3d38">        verbose_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;更新日&#39;</span>,
</span><span style="display:block;width:100%;background-color:#3c3d38">        auto_now<span style="color:#f92672">=</span>True
</span><span style="display:block;width:100%;background-color:#3c3d38">    )
</span></code></pre></td></tr></table>
</div>
</div><p>使用以下兩個指令生成migration並建立table</p>
<pre><code>python manage.py makemigrations
python manage.py migrate
</code></pre><p>接下來建立關鍵的Serializer，就之於html用的forms，在使用json的情況下則是用serializers來進行序列化，
和ModelForm不同的是，serializer也會用於view的response</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-:api/serializers.py" data-lang=":api/serializers.py"><span style="color:#f92672">from</span> rest_framework <span style="color:#f92672">import</span> serializers
<span style="color:#f92672">from</span> .models <span style="color:#f92672">import</span> Linkman

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LinkmanSerializer</span>(serializers<span style="color:#f92672">.</span>HyperlinkedModelSerializer):
    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Meta</span>:
        model <span style="color:#f92672">=</span> Linkman
        fields <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;name&#39;</span>, <span style="color:#e6db74">&#39;sex&#39;</span>, <span style="color:#e6db74">&#39;tel&#39;</span>, <span style="color:#e6db74">&#39;email&#39;</span>, <span style="color:#e6db74">&#39;created_at&#39;</span>, <span style="color:#e6db74">&#39;updated_at&#39;</span>]
</code></pre></td></tr></table>
</div>
</div><p>接下來就是處理view了，雖然一般會用以下的寫法</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LinkmanList</span>(APIView):
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get</span>(self, request, format<span style="color:#f92672">=</span>None):
        <span style="color:#f92672">...</span>

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">post</span>(self, request, format<span style="color:#f92672">=</span>None):
        <span style="color:#f92672">...</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LinkDetail</span>(APIView):
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get</span>(self, request, pk, format<span style="color:#f92672">=</span>None):
        <span style="color:#f92672">...</span>
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">put</span>(self, request, pk, format<span style="color:#f92672">=</span>None):
        <span style="color:#f92672">...</span>
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">delete</span>(self, request, pk, format<span style="color:#f92672">=</span>None):
        <span style="color:#f92672">...</span>
</code></pre></div><p>和相應的urlpattern
urls.py也能用以下寫法</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">urlpatterns <span style="color:#f92672">=</span> [
    path(<span style="color:#e6db74">&#39;&#39;</span>, views<span style="color:#f92672">.</span>LinkmanList<span style="color:#f92672">.</span>as_view()),
    path(<span style="color:#e6db74">&#39;&lt;int:pk&gt;/&#39;</span>, LinkmanDetail<span style="color:#f92672">.</span>as_view()),
]
</code></pre></div><p>但為了求快，view直接選擇可使用多種method的viewsets，而urlpattern選用routers</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-:api/views.py" data-lang=":api/views.py"><span style="color:#f92672">from</span> django.shortcuts <span style="color:#f92672">import</span> render
<span style="display:block;width:100%;background-color:#3c3d38"><span style="color:#f92672">from</span> rest_framework <span style="color:#f92672">import</span> viewsets
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="color:#f92672">from</span> rest_framework <span style="color:#f92672">import</span> permissions
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="color:#f92672">from</span> .models <span style="color:#f92672">import</span> Linkman
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="color:#f92672">from</span> .serializers <span style="color:#f92672">import</span> LinkmanSerializer
</span>
<span style="color:#75715e"># Create your views here.</span>

<span style="display:block;width:100%;background-color:#3c3d38"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LinkmanViewSet</span>(viewsets<span style="color:#f92672">.</span>ModelViewSet):
</span><span style="display:block;width:100%;background-color:#3c3d38">    queryset <span style="color:#f92672">=</span> Linkman<span style="color:#f92672">.</span>objects<span style="color:#f92672">.</span>all()
</span><span style="display:block;width:100%;background-color:#3c3d38">    serializer_class <span style="color:#f92672">=</span> LinkmanSerializer
</span><span style="display:block;width:100%;background-color:#3c3d38">    permission_classes <span style="color:#f92672">=</span> [permissions<span style="color:#f92672">.</span>IsAuthenticated]
</span></code></pre></td></tr></table>
</div>
</div><p>使用router的urls如下</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-:api/urls.py" data-lang=":api/urls.py"><span style="color:#f92672">from</span> django.urls <span style="color:#f92672">import</span> include, path
<span style="color:#f92672">from</span> rest_framework <span style="color:#f92672">import</span> routers
<span style="color:#f92672">from</span> .views <span style="color:#f92672">import</span> LinkmanViewSet

router <span style="color:#f92672">=</span> routers<span style="color:#f92672">.</span>DefaultRouter()
router<span style="color:#f92672">.</span>register(<span style="color:#e6db74">&#39;linkman&#39;</span>, LinkmanViewSet)

urlpatterns <span style="color:#f92672">=</span> [
    path(<span style="color:#e6db74">&#39;&#39;</span>, include(router<span style="color:#f92672">.</span>urls)),
    path(<span style="color:#e6db74">&#39;api-auth/&#39;</span>, include(<span style="color:#e6db74">&#39;rest_framework.urls&#39;</span>))
]
</code></pre></td></tr></table>
</div>
</div><p>既然viewsets已經包含了這麼多method，那現在的pattern到底會是怎樣呢？其實可以從router一窺究竟,
使用django shell</p>
<pre><code>python manage.py shell
</code></pre><p>照剛才的寫法，這就是urlpatterns中「''」include的內容</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">from</span> api <span style="color:#f92672">import</span> urls
<span style="color:#f92672">&gt;&gt;&gt;</span> urls<span style="color:#f92672">.</span>router<span style="color:#f92672">.</span>__dict__
{<span style="color:#e6db74">&#39;root_renderers&#39;</span>: [<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">class</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">rest_framework</span><span style="color:#f92672">.</span>renderers<span style="color:#f92672">.</span>JSONRenderer<span style="color:#e6db74">&#39;&gt;, &lt;class &#39;</span>rest_framework<span style="color:#f92672">.</span>rende
rers<span style="color:#f92672">.</span>BrowsableAPIRenderer<span style="color:#e6db74">&#39;&gt;], &#39;</span>trailing_slash<span style="color:#e6db74">&#39;: &#39;</span><span style="color:#f92672">/</span><span style="color:#e6db74">&#39;, &#39;</span>registry<span style="color:#e6db74">&#39;: [(&#39;</span>linkman<span style="color:#e6db74">&#39;, &lt;class &#39;</span>api<span style="color:#f92672">.</span>views<span style="color:#f92672">.</span>L
inkmanViewSet<span style="color:#e6db74">&#39;&gt;, &#39;</span>linkman<span style="color:#e6db74">&#39;)], &#39;</span>_urls<span style="color:#e6db74">&#39;: [&lt;URLPattern &#39;</span><span style="color:#f92672">^</span>linkman<span style="color:#f92672">/</span><span style="color:#960050;background-color:#1e0010">$</span><span style="color:#e6db74">&#39; [name=&#39;</span>linkman<span style="color:#f92672">-</span>list<span style="color:#e6db74">&#39;]&gt;, &lt;URLPatt</span>
ern <span style="color:#e6db74">&#39;^linkman\.(?P&lt;format&gt;[a-z0-9]+)/?$&#39;</span> [name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;linkman-list&#39;</span>]<span style="color:#f92672">&gt;</span>, <span style="color:#f92672">&lt;</span>URLPattern <span style="color:#e6db74">&#39;^linkman/(?P&lt;pk&gt;[^/</span>
<span style="color:#f92672">.</span>]<span style="color:#f92672">+</span>)<span style="color:#f92672">/</span><span style="color:#960050;background-color:#1e0010">$</span><span style="color:#e6db74">&#39; [name=&#39;</span>linkman<span style="color:#f92672">-</span>detail<span style="color:#e6db74">&#39;]&gt;, &lt;URLPattern &#39;</span><span style="color:#f92672">^</span>linkman<span style="color:#f92672">/</span>(<span style="color:#960050;background-color:#1e0010">?</span>P<span style="color:#f92672">&lt;</span>pk<span style="color:#f92672">&gt;</span>[<span style="color:#f92672">^/.</span>]<span style="color:#f92672">+</span>)\<span style="color:#f92672">.</span>(<span style="color:#960050;background-color:#1e0010">?</span>P<span style="color:#f92672">&lt;</span>format<span style="color:#f92672">&gt;</span>[a<span style="color:#f92672">-</span>z0<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>]<span style="color:#f92672">+</span>)<span style="color:#f92672">/</span><span style="color:#960050;background-color:#1e0010">?$</span><span style="color:#e6db74">&#39;</span>
 [name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;linkman-detail&#39;</span>]<span style="color:#f92672">&gt;</span>, <span style="color:#f92672">&lt;</span>URLPattern <span style="color:#e6db74">&#39;^$&#39;</span> [name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;api-root&#39;</span>]<span style="color:#f92672">&gt;</span>, <span style="color:#f92672">&lt;</span>URLPattern <span style="color:#e6db74">&#39;^\.(?P&lt;format&gt;[a-z0-</span>
<span style="color:#ae81ff">9</span>]<span style="color:#f92672">+</span>)<span style="color:#f92672">/</span><span style="color:#960050;background-color:#1e0010">?$</span><span style="color:#e6db74">&#39; [name=&#39;</span>api<span style="color:#f92672">-</span>root<span style="color:#e6db74">&#39;]&gt;]}</span>

</code></pre></div><p>project的urls.py要記得include app的urls.py，接下來就大功告成</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-:django_rest_example/urls.py" data-lang=":django_rest_example/urls.py"><span style="color:#f92672">from</span> django.contrib <span style="color:#f92672">import</span> admin
<span style="display:block;width:100%;background-color:#3c3d38"><span style="color:#f92672">from</span> django.urls <span style="color:#f92672">import</span> path, include
</span>
urlpatterns <span style="color:#f92672">=</span> [
    path(<span style="color:#e6db74">&#39;admin/&#39;</span>, admin<span style="color:#f92672">.</span>site<span style="color:#f92672">.</span>urls),
<span style="display:block;width:100%;background-color:#3c3d38">    path(<span style="color:#e6db74">&#39;&#39;</span>, include(<span style="color:#e6db74">&#39;api.urls&#39;</span>)),
</span>]
</code></pre></td></tr></table>
</div>
</div><p>一樣用runserver這個指令來啟動WSGI</p>
<pre><code>python manage.py runserver
</code></pre><p>因為permission有指定IsAuthenticated，所以沒有加上user:password的話會失敗</p>
<pre><code>$ curl http://127.0.0.1:8000/api/linkman/
{&quot;detail&quot;:&quot;Authentication credentials were not provided.&quot;}
</code></pre><p>post</p>
<pre><code>$ curl http://127.0.0.1:8000/api/linkman/ -u admin:123 -X POST -H 'Content-Type: application/json' 
    \ -d '{&quot;name&quot;:&quot;orz&quot;,&quot;sex&quot;:1,&quot;tel&quot;:&quot;123&quot;,&quot;email&quot;:&quot;qq@qq.qq&quot;}'
{&quot;name&quot;:&quot;orz&quot;,&quot;sex&quot;:1,&quot;tel&quot;:&quot;123&quot;,&quot;email&quot;:&quot;qq@qq.qq&quot;,&quot;created_at&quot;:&quot;2020-07-18T18:11:11.137940Z&quot;,&quot;updated_at&quot;:&quot;2020-07-18T18:48:53.737802Z&quot;}
</code></pre><p>get</p>
<pre><code>$ curl http://127.0.0.1:8000/api/linkman/ -u admin:123
[{&quot;name&quot;:&quot;orz&quot;,&quot;sex&quot;:1,&quot;tel&quot;:&quot;123&quot;,&quot;email&quot;:&quot;qq@qq.qq&quot;,&quot;created_at&quot;:&quot;2020-07-18T18:11:11.137940Z&quot;,&quot;updated_at&quot;:&quot;2020-07-18T18:48:53.737802Z&quot;}] 
</code></pre><p>get detail</p>
<pre><code>$ curl http://127.0.0.1:8000/api/linkman/1/ -u admin:123
{&quot;name&quot;:&quot;orz&quot;,&quot;sex&quot;:1,&quot;tel&quot;:&quot;123&quot;,&quot;email&quot;:&quot;qq@qq.qq&quot;,&quot;created_at&quot;:&quot;2020-07-18T18:11:11.137940Z&quot;,&quot;updated_at&quot;:&quot;2020-07-18T18:52:39.098101Z&quot;}
</code></pre><p>put</p>
<pre><code>$ curl http://127.0.0.1:8000/api/linkman/ -u admin:123 -X POST -H 'Content-Type: application/json' 
    \ -d '{&quot;name&quot;:&quot;orz&quot;,&quot;sex&quot;:1,&quot;tel&quot;:&quot;123&quot;,&quot;email&quot;:&quot;qq@qq.qq&quot;}'
{&quot;name&quot;:&quot;orz&quot;,&quot;sex&quot;:1,&quot;tel&quot;:&quot;123&quot;,&quot;email&quot;:&quot;qq@qq.qq&quot;,&quot;created_at&quot;:&quot;2020-07-18T18:11:11.137940Z&quot;,&quot;updated_at&quot;:&quot;2020-07-18T18:48:53.737802Z&quot;}
</code></pre><p>patch</p>
<pre><code>$ curl http://127.0.0.1:8000/api/linkman/ -u admin:123 -X POST -H 'Content-Type: application/json' 
    \ -d '{&quot;sex&quot;:2}'
{&quot;name&quot;:&quot;orz&quot;,&quot;sex&quot;:2,&quot;tel&quot;:&quot;123&quot;,&quot;email&quot;:&quot;qq@qq.qq&quot;,&quot;created_at&quot;:&quot;2020-07-18T18:11:11.137940Z&quot;,&quot;updated_at&quot;:&quot;2020-07-18T18:52:53.737802Z&quot;}
</code></pre><p>也有web可以提供使用</p>
<img style="display:inline;" width="150" src="1.png">
<img style="display:inline;" width="150" src="2.png">
<img style="display:inline;" width="150" src="3.png">


<v-card class="mt-5 content">
  <v-card-text>
  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "mikanmimi" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </v-card-text>
</v-card>
