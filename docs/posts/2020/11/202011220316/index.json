



    
        
    




{
  "result": {
    "content": "\u003cp\u003e延續前一篇的練習，這次使用Django來配合noVNC與Websockify，亂玩一通來幫助記憶\u003c/p\u003e\n\u003cp\u003e想到Websocket有\u003ccode\u003e--target-conf\u003c/code\u003e這個option怎不能好好利用一下呢？\u003c/p\u003e\n\u003cp\u003e思路是這樣的，為了讓使用者更「安全」地使用VNC Server，最好不要暴露出host ip與port，甚至使用firewall阻擋到僅能讓proxy\n連線，而一切的資料最好由管理員統一管理，所以這裡的想法就是用Django來進行這個任務\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"1.svg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e照圖來說，Django負責儲存VNC Server的資訊，並能將該VNC資訊與臨時的token寫進token.conf供proxy(websockify)讀取，同時把包含token的response(noVNC)給client，如此一來client和proxy之間完全不會傳輸任何VNC Server的資訊，接下來就是動手做做看了\n\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e首先一樣建立django project\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$ django-admin startproject django_novnc_example\r\n$ cd django_novnc_example\r\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e第一步就是定義好model，只需要vnc server的ip與port，作為寫入token.conf的依據\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\n\u003ctable style=\"border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;\"\u003e\u003ctr\u003e\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 1\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 2\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 3\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 4\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 5\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 6\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 7\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 8\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 9\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e10\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;;width:100%\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-:run_novnc/models.py\" data-lang=\":run_novnc/models.py\"\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e django.db \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e models\n\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e uuid \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e uuid4\n\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e django.core.validators \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e MaxValueValidator, MinValueValidator\n\n\u003cspan style=\"color:#75715e\"\u003e# Create your models here.\u003c/span\u003e\n\u003cspan style=\"color:#66d9ef\"\u003eclass\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eVNCSession\u003c/span\u003e(models\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eModel):\n    id \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e models\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eUUIDField(primary_key\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eTrue, default\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003euuid4, editable\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eFalse)\n    ip4_addr \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e models\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eGenericIPAddressField(protocol\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;IPv4\u0026#39;\u003c/span\u003e)\n    vnc_port \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e models\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eIntegerField(validators\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e[MaxValueValidator(\u003cspan style=\"color:#ae81ff\"\u003e65535\u003c/span\u003e), MinValueValidator(\u003cspan style=\"color:#ae81ff\"\u003e1024\u003c/span\u003e)])\n    password \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e models\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eCharField(max_length\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e50\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e將剛才建立的model註冊到admin，之後就用django admin來建立vnc資訊\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\n\u003ctable style=\"border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;\"\u003e\u003ctr\u003e\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e1\n\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e2\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e3\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e4\n\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e5\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e6\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e7\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e8\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;;width:100%\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-:run_novnc/admin.py\" data-lang=\":run_novnc/admin.py\"\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e django.contrib \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e admin\n\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e .models \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e VNCSession\n\u003c/span\u003e\n\u003cspan style=\"color:#75715e\"\u003e# Register your models here.\u003c/span\u003e\n\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"color:#66d9ef\"\u003eclass\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eVNCSessionAdmin\u003c/span\u003e(admin\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eModelAdmin):\n\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e    fields \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;ip4_addr\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;vnc_port\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;password\u0026#39;\u003c/span\u003e]\n\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\n\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003eadmin\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esite\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eregister(VNCSession, VNCSessionAdmin)\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e然後寫上view，測試只要定義兩個簡單的就好，一個用於列表，另一個則是測試的主角novnc，token的控制為使用token_hex()隨機產生一個塞進token.conf，且使用Timer於一秒後用空白覆蓋掉token.conf，此作法的缺點在於連續request的時候可能會因時間差導致token.conf在websockify讀取前就被前一個request的空白覆蓋…有想過是否用replace的方式單獨處理，但可能也會有同樣機率發生刪不乾淨的問題，除非能找到一個好的trigger\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\n\u003ctable style=\"border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;\"\u003e\u003ctr\u003e\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 1\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 2\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 3\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 4\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 5\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 6\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 7\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 8\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e 9\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e10\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e11\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e12\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e13\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e14\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e15\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e16\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e17\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e18\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e19\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e20\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e21\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e22\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e23\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e24\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e25\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e26\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;;width:100%\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-:run_novnc/views.py\" data-lang=\":run_novnc/views.py\"\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e django.shortcuts \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e render\n\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e .models \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e VNCSession\n\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e secrets \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e token_hex\n\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e threading \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e Timer\n\n\u003cspan style=\"color:#75715e\"\u003e# Create your views here.\u003c/span\u003e\n\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elist\u003c/span\u003e(request):\n    vnc_list \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e VNCSession\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eobjects\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eall()\n    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e render(request, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;run_novnc/list.html\u0026#39;\u003c/span\u003e, {\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;vnc_list\u0026#39;\u003c/span\u003e: vnc_list})\n\n\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eset_token\u003c/span\u003e(token):\n    f \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e open(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;token/token.conf\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;w\u0026#39;\u003c/span\u003e)\n    f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ewrite(token)\n    f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eclose()\n\n\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003enovnc\u003c/span\u003e(request, id):\n    vnc \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e VNCSession\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eobjects\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eget(id\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eid)\n    token \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e token_hex(\u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e)\n    vnc_ip \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e vnc\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eip4_addr\n    vnc_port \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e vnc\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003evnc_port\n    password \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e vnc\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epassword\n    context \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;proxy_ip\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;192.168.149.131\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;proxy_port\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e6080\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;token\u0026#39;\u003c/span\u003e: token, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;password\u0026#39;\u003c/span\u003e: password}\n    set_token(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%i\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e%\u003c/span\u003e (token, vnc_ip, vnc_port)) \u003cspan style=\"color:#75715e\"\u003e# 寫入產生的token\u003c/span\u003e\n    Timer(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, set_token, [\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e])\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estart() \u003cspan style=\"color:#75715e\"\u003e# 一秒候用空白覆蓋\u003c/span\u003e\n\n    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e render(request, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;run_novnc/vnc_lite_test.html\u0026#39;\u003c/span\u003e, context)\n\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e接下來就是template，簡單就好，首先是list\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\n\u003ctable style=\"border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;\"\u003e\u003ctr\u003e\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e1\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e2\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e3\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;;width:100%\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-:run_novnc/templates/run_novnc/list.html\" data-lang=\":run_novnc/templates/run_novnc/list.html\"\u003e{% for vnc in vnc_list %}\n    \u0026lt;\u003cspan style=\"color:#f92672\"\u003ea\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehref\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003evnc/{{\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003evnc\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e}}\u003c/span\u003e\u0026gt;{{ vnc.id }}\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ea\u003c/span\u003e\u0026gt;\n{% endfor %}\n\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e再來是主角的novnc，檔案的來源是noVNC/vnc_lite.html，避免干涉問題，如core之類的static file使用settings.py的/static/，所以以下部分要修一下，讓外部的script走新的path\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\n\u003ctable style=\"border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;\"\u003e\u003ctr\u003e\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e64\n\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e65\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e66\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e67\n\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e68\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e69\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e70\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e71\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e72\n\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e73\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e74\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e75\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e76\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;;width:100%\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-:run_novnc/templates/run_novnc/vnc_lite_test.html\" data-lang=\":run_novnc/templates/run_novnc/vnc_lite_test.html\"\u003e    \u003cspan style=\"color:#75715e\"\u003e\u0026lt;!-- Promise polyfill for IE11 --\u0026gt;\u003c/span\u003e\n\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e    \u0026lt;\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esrc\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/static/vendor/promise.js\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\n    \u003cspan style=\"color:#75715e\"\u003e\u0026lt;!-- ES2015/ES6 modules polyfill --\u0026gt;\u003c/span\u003e\n\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e    \u0026lt;\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003enomodule\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esrc\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/static/vendor/browser-es-module-loader/dist/browser-es-module-loader.js\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\n    \u003cspan style=\"color:#75715e\"\u003e\u0026lt;!-- actual script modules --\u0026gt;\u003c/span\u003e\n    \u0026lt;\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;module\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecrossorigin\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;anonymous\u0026#34;\u003c/span\u003e\u0026gt;\n        // RFB holds the API to connect and communicate with a VNC server\n\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e        import RFB from \u0026#39;/static/core/rfb.js\u0026#39;;\n\u003c/span\u003e\n        let rfb;\n        let desktopName;\n\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e有點個人興趣的部分，把原本的query換成django template\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\n\u003ctable style=\"border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;\"\u003e\u003ctr\u003e\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e144\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e145\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e146\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e147\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e148\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e149\n\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e150\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e151\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e152\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e153\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;;width:100%\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-:run_novnc/templates/run_novnc/vnc_lite_test.html\" data-lang=\":run_novnc/templates/run_novnc/vnc_lite_test.html\"\u003e        /*\n        const host = readQueryVariable(\u0026#39;host\u0026#39;, window.location.hostname);\n        let port = readQueryVariable(\u0026#39;port\u0026#39;, window.location.port);\n        const password = readQueryVariable(\u0026#39;password\u0026#39;);\n        const path = readQueryVariable(\u0026#39;path\u0026#39;, \u0026#39;websockify\u0026#39;);\n        */\n\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e        const host = \u0026#39;{{ proxy_ip }}\u0026#39;\n\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e        const port = {{ proxy_port }}\n\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e        const password = \u0026#39;{{ password }}\u0026#39;\n\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e        const path = \u0026#39;websockify/?token={{ token }}\u0026#39;\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003eapp差不多完成了，補上app的urls\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\n\u003ctable style=\"border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;\"\u003e\u003ctr\u003e\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e1\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e2\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e3\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e4\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e5\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e6\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;;width:100%\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-:run_novnc/urls.py\" data-lang=\":run_novnc/urls.py\"\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e django.urls \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e path\n\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e . \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e views\n\nurlpatterns \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [\n    path(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e, views\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003elist, name\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;list\u0026#39;\u003c/span\u003e),\n    path(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;str:id\u0026gt;\u0026#39;\u003c/span\u003e, views\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003enovnc, name\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;novnc\u0026#39;\u003c/span\u003e),\n]\n\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003eproject的urls.py也include剛才建立的app的urls.py，並在pattern加上static\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\n\u003ctable style=\"border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;\"\u003e\u003ctr\u003e\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e16\n\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e17\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e18\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e19\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e20\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e21\n\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e22\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e23\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e24\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;;width:100%\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-:django_novnc_example/urls.py\" data-lang=\":django_novnc_example/urls.py\"\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e django.contrib \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e admin\n\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e django.urls \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e path, include\n\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e django.conf \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e settings\n\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e django.conf.urls.static \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e static\n\nurlpatterns \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [\n\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e    path(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;admin/\u0026#39;\u003c/span\u003e, admin\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esite\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eurls),\n\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e    path(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e, include(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;run_novnc.urls\u0026#39;\u003c/span\u003e))\n\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e static(settings\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eSTATIC_URL, document_root\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003esettings\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eSTATIC_ROOT)\n\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003esettings.py加上static的檔案目錄\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\n\u003ctable style=\"border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;\"\u003e\u003ctr\u003e\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e121\n\u003c/span\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e122\n\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e123\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e124\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e\u003cspan style=\"margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f\"\u003e125\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;;width:100%\"\u003e\n\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-:django_novnc_example/settings.py\" data-lang=\":django_novnc_example/settings.py\"\u003eSTATIC_URL \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;/static/\u0026#39;\u003c/span\u003e\n\n\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003eSTATICFILES_DIRS \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [\n\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e    os\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epath\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ejoin(BASE_DIR, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;static\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003cspan style=\"display:block;width:100%;background-color:#3c3d38\"\u003e]\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e記得複製noVNC的core、vendor兩個目錄進來\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003estatic\r\n├─core\r\n│  ├─decoders\r\n│  ├─input\r\n│  └─util\r\n└─vendor\r\n    ├─browser-es-module-loader\r\n    │  ├─dist\r\n    │  └─src\r\n    └─pako\r\n        └─lib\r\n            ├─utils\r\n            └─zlib\r\n\r\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e接下來就是測試時間了，一樣使用compose，目錄大概是這樣\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e.\r\n├── django_novnc_example\r\n│   ├── db.sqlite3\r\n│   ├── django_novnc_example\r\n|   ...\r\n├── docker-compose.yml\r\n├── Dockerfile\r\n└── websockify\r\n    ├── CHANGES.txt\r\n    ....\r\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003eDockerfile很單純，主要就下載django\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-:Dockerfile\" data-lang=\":Dockerfile\"\u003eFROM python:3.8.4\r\nRUN mkdir -p /demo\r\nWORKDIR /demo\r\nRUN pip install django\r\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003ecommand property稍微長一點，省麻煩所以只使用一個container來啟動django自帶的wsgi及作為vnc proxy的websockify\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-:docker-compose.yml\" data-lang=\":docker-compose.yml\"\u003e\u003cspan style=\"color:#f92672\"\u003eversion\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;3\u0026#39;\u003c/span\u003e\n\u003cspan style=\"color:#f92672\"\u003eservices\u003c/span\u003e:\n  \u003cspan style=\"color:#f92672\"\u003edemo\u003c/span\u003e:\n    \u003cspan style=\"color:#f92672\"\u003erestart\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ealways\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003ebuild\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e.\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003eports\u003c/span\u003e:\n      - \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;8000:8000\u0026#34;\u003c/span\u003e\n      - \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;6080:6080\u0026#34;\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003evolumes\u003c/span\u003e:\n      - \u003cspan style=\"color:#ae81ff\"\u003e./django_novnc_example:/demo\u003c/span\u003e\n      - \u003cspan style=\"color:#ae81ff\"\u003e./websockify:/websockify\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003edeploy\u003c/span\u003e:\n      \u003cspan style=\"color:#f92672\"\u003erestart_policy\u003c/span\u003e:\n        \u003cspan style=\"color:#f92672\"\u003econdition\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003eon\u003c/span\u003e-\u003cspan style=\"color:#ae81ff\"\u003efailure\u003c/span\u003e\n    \u003cspan style=\"color:#f92672\"\u003ecommand\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ebash -c \u0026#34;python3 manage.py runserver 0.0.0.0:8000 \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 \u0026amp; /websockify/websockify.py --target-config=/demo/token/token.conf 6080\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e指令給他打下去就大功告成了\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# docker-compose up\r\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e連上網址後先進/admin由django admin建立vnc server資料\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"1.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cbr\u003e\u003c/br\u003e\u003c/p\u003e\n\u003cp\u003e接下來就能進主頁測試，如此就能看到token一秒被清空，且一直用不同的path與ws連線了\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"1.gif\" alt=\"\"\u003e\u003c/p\u003e",
    "kind": "page",
    "params": {
      "categories": [
        "Web Development"
      ],
      "date": "2020-11-22T03:16:02+08:00",
      "draft": false,
      "iscjklanguage": true,
      "lastmod": "2020-11-22T03:16:02+08:00",
      "publishdate": "2020-11-22T03:16:02+08:00",
      "tags": [
        "Django",
        "Python",
        "noVNC",
        "Docker"
      ],
      "title": "整合noVNC至Django template的小練習"
    },
    "permalink": "https://mikanbearer.github.io/posts/2020/11/202011220316/index.json",
    "type": "posts",
    "wordcount": 1846
  }
}