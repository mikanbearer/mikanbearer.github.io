<p>經過了前面的練習，咱們的小App已經有了ORM，既然有了ORM，不做成CRUD(Create、Read、Update、Delete)怎麼行？</p>
<p>所以繼續動手做</p>
<p>完成的source code放在<a href="https://github.com/mikanbearer/flask_crud_example/releases/tag/simple_crud">這裡</a></p>
<p>這次主要在於練習template的搭配，為省下初期佈建的麻煩，多加上Flask-Migrate簡化初期的部屬步驟，這樣就不需要用python shell來操作了</p>
<p>首先安裝Flask-Migrate</p>
<pre><code>pip install Flask-Migrate
</code></pre><p><br></br>
在app中增加Migrate</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-:app/app.py" data-lang=":app/app.py"><span style="color:#f92672">from</span> flask <span style="color:#f92672">import</span> Flask, request, render_template
<span style="color:#f92672">from</span> flask_sqlalchemy <span style="color:#f92672">import</span> SQLAlchemy
<span style="display:block;width:100%;background-color:#3c3d38"><span style="color:#f92672">from</span> flask_migrate <span style="color:#f92672">import</span> Migrate
</span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime

app <span style="color:#f92672">=</span> Flask(__name__)
app<span style="color:#f92672">.</span>config[<span style="color:#e6db74">&#39;SQLALCHEMY_DATABASE_URI&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;sqlite:///app.db?check_same_thread=False&#39;</span>
db <span style="color:#f92672">=</span> SQLAlchemy(app)
<span style="display:block;width:100%;background-color:#3c3d38">migrate <span style="color:#f92672">=</span> Migrate(app, db)
</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span>(db<span style="color:#f92672">.</span>Model):
    id <span style="color:#f92672">=</span> db<span style="color:#f92672">.</span>Column(db<span style="color:#f92672">.</span>Integer, primary_key<span style="color:#f92672">=</span>True)
    username <span style="color:#f92672">=</span> db<span style="color:#f92672">.</span>Column(db<span style="color:#f92672">.</span>String(<span style="color:#ae81ff">80</span>), unique<span style="color:#f92672">=</span>True, nullable<span style="color:#f92672">=</span>False)
    email <span style="color:#f92672">=</span> db<span style="color:#f92672">.</span>Column(db<span style="color:#f92672">.</span>String(<span style="color:#ae81ff">120</span>), unique<span style="color:#f92672">=</span>True, nullable<span style="color:#f92672">=</span>False)
    created_at <span style="color:#f92672">=</span> db<span style="color:#f92672">.</span>Column(db<span style="color:#f92672">.</span>DateTime, nullable<span style="color:#f92672">=</span>False, default<span style="color:#f92672">=</span>datetime<span style="color:#f92672">.</span>now)
    updated_at <span style="color:#f92672">=</span> db<span style="color:#f92672">.</span>Column(db<span style="color:#f92672">.</span>DateTime, nullable<span style="color:#f92672">=</span>False, default<span style="color:#f92672">=</span>datetime<span style="color:#f92672">.</span>now, onupdate<span style="color:#f92672">=</span>datetime<span style="color:#f92672">.</span>now)

    <span style="color:#66d9ef">def</span> __repr__(self):
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;&lt;User </span><span style="color:#e6db74">%r</span><span style="color:#e6db74">&gt;&#39;</span> <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>username
</code></pre></div><p><br></br>
之後輸入指令</p>
<pre><code>$ flask db init
</code></pre><p><br></br>
這樣目錄中會產生migrations</p>
<pre><code>.
│  run.py
│
├─app
│     app.py
│
└─migrations
      alembic.ini
      env.py
      README
      script.py.mako
</code></pre><p><br></br>
接下來輸入以下指令就能寫進db了</p>
<pre><code>$ flask db upgrade
</code></pre><p><br></br>
接下來就開始把app完成，首先是必要的模組與第一個view，也就是list</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-app:app.py" data-lang="app:app.py"><span style="color:#f92672">from</span> flask <span style="color:#f92672">import</span> Flask, request, render_template, redirect, url_for <span style="color:#75715e">#redirect為重新導向用，url_for能將name轉換成url</span>
<span style="color:#f92672">from</span> flask_sqlalchemy <span style="color:#f92672">import</span> SQLAlchemy
<span style="color:#f92672">from</span> flask_migrate <span style="color:#f92672">import</span> Migrate
<span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime

<span style="color:#f92672">...</span>

<span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/&#39;</span>)
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">list</span>():
    users <span style="color:#f92672">=</span> User<span style="color:#f92672">.</span>query<span style="color:#f92672">.</span>all()
    <span style="color:#66d9ef">return</span> render_template(<span style="color:#e6db74">&#39;list.html&#39;</span>, users<span style="color:#f92672">=</span>users)
</code></pre></div><p>只是一個很普通的get
<br></br>
接下來就是template，這次用{% extend %}來節省一下文件行數，畢竟head和script都是會重複的部分，這次範例使用bootstrap4來儘量讓版面好看</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-:app/templates/base.html" data-lang=":app/templates/base.html"><span style="color:#75715e">&lt;!doctype html&gt;</span>
&lt;<span style="color:#f92672">html</span>&gt;
  &lt;<span style="color:#f92672">head</span>&gt;
    &lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css&#34;</span> <span style="color:#a6e22e">integrity</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm&#34;</span> <span style="color:#a6e22e">crossorigin</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;anonymous&#34;</span>&gt;
    &lt;<span style="color:#f92672">title</span>&gt;Flask CRUD Example&lt;/<span style="color:#f92672">title</span>&gt;
  &lt;/<span style="color:#f92672">head</span>&gt;
  &lt;<span style="color:#f92672">body</span>&gt;
    &lt;<span style="color:#f92672">nav</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;navbar navbar-expand-lg navbar-light bg-light&#34;</span>&gt;
  &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;navbar-brand&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{ url_for(&#39;list&#39;) }}&#34;</span>&gt;Flask CRUD Example&lt;/<span style="color:#f92672">a</span>&gt;
  &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;navbar-toggler&#34;</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;button&#34;</span> <span style="color:#a6e22e">data-toggle</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;collapse&#34;</span> <span style="color:#a6e22e">data-target</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;#navbarText&#34;</span> <span style="color:#a6e22e">aria-controls</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;navbarText&#34;</span> <span style="color:#a6e22e">aria-expanded</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;false&#34;</span> <span style="color:#a6e22e">aria-label</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Toggle navigation&#34;</span>&gt;
    &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;navbar-toggler-icon&#34;</span>&gt;&lt;/<span style="color:#f92672">span</span>&gt;
  &lt;/<span style="color:#f92672">button</span>&gt;
  &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;collapse navbar-collapse&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;navbarText&#34;</span>&gt;
    &lt;<span style="color:#f92672">ul</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;navbar-nav mr-auto&#34;</span>&gt;
      &lt;<span style="color:#f92672">li</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;nav-item&#34;</span>&gt;
        &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;nav-link&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">{{</span> <span style="color:#a6e22e">url_for</span><span style="color:#960050;background-color:#1e0010">(&#39;</span><span style="color:#a6e22e">list</span><span style="color:#960050;background-color:#1e0010">&#39;)</span> <span style="color:#960050;background-color:#1e0010">}}</span>&gt;List&lt;/<span style="color:#f92672">a</span>&gt; {# link to list #}
      &lt;/<span style="color:#f92672">li</span>&gt;
      &lt;<span style="color:#f92672">li</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;nav-item&#34;</span>&gt;
        &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;nav-link&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">{{</span> <span style="color:#a6e22e">url_for</span><span style="color:#960050;background-color:#1e0010">(&#39;</span><span style="color:#a6e22e">create</span><span style="color:#960050;background-color:#1e0010">&#39;)</span> <span style="color:#960050;background-color:#1e0010">}}</span>&gt;Create&lt;/<span style="color:#f92672">a</span>&gt; {# link to create #}
      &lt;/<span style="color:#f92672">li</span>&gt;
    &lt;/<span style="color:#f92672">ul</span>&gt;
  &lt;/<span style="color:#f92672">div</span>&gt;
&lt;/<span style="color:#f92672">nav</span>&gt;
    {% block content %}
    {% endblock %}
  &lt;/<span style="color:#f92672">body</span>&gt;
  &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://code.jquery.com/jquery-3.2.1.slim.min.js&#34;</span> <span style="color:#a6e22e">integrity</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN&#34;</span> <span style="color:#a6e22e">crossorigin</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;anonymous&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
  &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js&#34;</span> <span style="color:#a6e22e">integrity</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q&#34;</span> <span style="color:#a6e22e">crossorigin</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;anonymous&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
  &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js&#34;</span> <span style="color:#a6e22e">integrity</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl&#34;</span> <span style="color:#a6e22e">crossorigin</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;anonymous&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
&lt;/<span style="color:#f92672">html</span>&gt;
</code></pre></div><p>為求簡單，就只切一個名為content的block
<br></br>
接下來的才是list用的template本體</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-:app/templates/list.html" data-lang=":app/templates/list.html">{% extends &#39;base.html&#39; %}
{% block content %}
&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;container mt-4&#34;</span>&gt;
    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;row&#34;</span>&gt;
        &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;col-12&#34;</span>&gt;
            &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;card&#34;</span>&gt;
                &lt;<span style="color:#f92672">h5</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;card-header&#34;</span>&gt;
                    List
                &lt;/<span style="color:#f92672">h5</span>&gt;
                &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;card-body&#34;</span>&gt;
                    &lt;<span style="color:#f92672">ul</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;list-group&#34;</span>&gt;
                        {% for user in users %}
                        &lt;<span style="color:#f92672">li</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;list-group-item&#34;</span>&gt;
                            &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;row&#34;</span>&gt;
                                &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;col-3&#34;</span>&gt;
                                    &lt;<span style="color:#f92672">p</span>&gt;Name&lt;/<span style="color:#f92672">p</span>&gt;
                                &lt;/<span style="color:#f92672">div</span>&gt;
                                &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;col-9&#34;</span>&gt;
                                    &lt;<span style="color:#f92672">p</span>&gt;{{ user.username }}&lt;/<span style="color:#f92672">p</span>&gt;
                                &lt;/<span style="color:#f92672">div</span>&gt;
                            &lt;/<span style="color:#f92672">div</span>&gt;
                            &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;row&#34;</span>&gt;
                                &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;col-3&#34;</span>&gt;
                                    &lt;<span style="color:#f92672">p</span>&gt;Created at&lt;/<span style="color:#f92672">p</span>&gt;
                                &lt;/<span style="color:#f92672">div</span>&gt;
                                &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;col-9&#34;</span>&gt;
                                    &lt;<span style="color:#f92672">p</span>&gt;{{user.created_at}}&lt;/<span style="color:#f92672">p</span>&gt;
                                &lt;/<span style="color:#f92672">div</span>&gt;
                            &lt;/<span style="color:#f92672">div</span>&gt;
                            &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;row&#34;</span>&gt;
                                &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;col-12&#34;</span>&gt;
                                    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;float-right&#34;</span>&gt;
                                        &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;btn btn-primary&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{ url_for(&#39;detail&#39;, user_id=user.id) }}&#34;</span> <span style="color:#a6e22e">role</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;button&#34;</span>&gt;Detail&lt;/<span style="color:#f92672">a</span>&gt;
                                        &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;btn btn-primary&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{ url_for(&#39;update&#39;, user_id=user.id) }}&#34;</span> <span style="color:#a6e22e">role</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;button&#34;</span>&gt;Update&lt;/<span style="color:#f92672">a</span>&gt;
                                        &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;btn btn-primary&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{ url_for(&#39;delete&#39;, user_id=user.id) }}&#34;</span> <span style="color:#a6e22e">role</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;button&#34;</span>&gt;Delete&lt;/<span style="color:#f92672">a</span>&gt;
                                    &lt;/<span style="color:#f92672">div</span>&gt;
                                &lt;/<span style="color:#f92672">div</span>&gt;
                            &lt;/<span style="color:#f92672">div</span>&gt;
                        &lt;/<span style="color:#f92672">li</span>&gt;
                        {% endfor %}
                    &lt;/<span style="color:#f92672">ul</span>&gt;
                &lt;/<span style="color:#f92672">div</span>&gt;
            &lt;/<span style="color:#f92672">div</span>&gt;
        &lt;/<span style="color:#f92672">div</span>&gt;
    &lt;/<span style="color:#f92672">div</span>&gt;
</code></pre></div><p><br></br>
下一個view是create，因為template能和update共用，所以就一併做</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-:app/app.py" data-lang=":app/app.py"><span style="color:#f92672">...</span>

<span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/create&#39;</span>, methods<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;get&#39;</span>, <span style="color:#e6db74">&#39;post&#39;</span>])
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">create</span>():
    <span style="color:#66d9ef">if</span> request<span style="color:#f92672">.</span>method <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;POST&#39;</span>:
        username <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>form[<span style="color:#e6db74">&#39;username&#39;</span>]
        email <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>form[<span style="color:#e6db74">&#39;email&#39;</span>]
        user <span style="color:#f92672">=</span> User(username<span style="color:#f92672">=</span>username, email<span style="color:#f92672">=</span>email)
        db<span style="color:#f92672">.</span>session<span style="color:#f92672">.</span>add(user)
        db<span style="color:#f92672">.</span>session<span style="color:#f92672">.</span>commit()
        <span style="color:#66d9ef">return</span> redirect(url_for(<span style="color:#e6db74">&#39;list&#39;</span>))
    <span style="color:#66d9ef">return</span> render_template(<span style="color:#e6db74">&#39;form.html&#39;</span>)

<span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/update/&lt;user_id&gt;&#39;</span>, methods<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;get&#39;</span>, <span style="color:#e6db74">&#39;post&#39;</span>])
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">update</span>(user_id):
    user <span style="color:#f92672">=</span> User<span style="color:#f92672">.</span>query<span style="color:#f92672">.</span>filter_by(id<span style="color:#f92672">=</span>user_id)<span style="color:#f92672">.</span>first()
    <span style="color:#66d9ef">if</span> request<span style="color:#f92672">.</span>method <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;POST&#39;</span>:
        user<span style="color:#f92672">.</span>username <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>form[<span style="color:#e6db74">&#39;username&#39;</span>]
        user<span style="color:#f92672">.</span>email <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>form[<span style="color:#e6db74">&#39;email&#39;</span>]
        db<span style="color:#f92672">.</span>session<span style="color:#f92672">.</span>add(user)
        db<span style="color:#f92672">.</span>session<span style="color:#f92672">.</span>commit()
        <span style="color:#66d9ef">return</span> redirect(url_for(<span style="color:#e6db74">&#39;list&#39;</span>))
    <span style="color:#66d9ef">return</span> render_template(<span style="color:#e6db74">&#39;form.html&#39;</span>, user<span style="color:#f92672">=</span>user)
</code></pre></div><p>兩個基本上都有GET、POST兩個method，而update在get的時候會返回user
<br></br>
接下來是共通的template</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-:app/templates/form.html" data-lang=":app/templates/form.html">{% extends &#39;base.html&#39; %}
{% block content %}
&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;container mt-4&#34;</span>&gt;
    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;row&#34;</span>&gt;
        &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;col-12&#34;</span>&gt;
            &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;card&#34;</span>&gt;
                &lt;<span style="color:#f92672">h5</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;card-header&#34;</span>&gt;
                    {% if user %}
                        {% set username, email = user.username, user.email %} {# set username及email兩個變數 #}
                        Update: {{ username }}
                    {% else %}
                        Create user
                        {% set username, email = &#39;&#39;, &#39;&#39; %} {# 若無user(也就是在create時)則為空白 #}
                    {% endif %}
                &lt;/<span style="color:#f92672">h5</span>&gt;
                &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;card-body&#34;</span>&gt;
                    &lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;post&#34;</span>&gt; {# 將username及email都放進input內的value這個attr #}
                        &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;form-group&#34;</span>&gt;
                            &lt;<span style="color:#f92672">label</span> <span style="color:#a6e22e">for</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;username&#34;</span>&gt;Username&lt;/<span style="color:#f92672">label</span>&gt;
                            &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;username&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;username&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{ username }}&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;form-control&#34;</span>&gt;
                        &lt;/<span style="color:#f92672">div</span>&gt;
                        &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;form-group&#34;</span>&gt;
                            &lt;<span style="color:#f92672">label</span> <span style="color:#a6e22e">for</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;email&#34;</span>&gt;Email&lt;/<span style="color:#f92672">label</span>&gt;
                            &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;email&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;email&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{ email }}&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;form-control&#34;</span>&gt;
                        &lt;/<span style="color:#f92672">div</span>&gt;
                        &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;btn btn-primary&#34;</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span>&gt;Submit&lt;/<span style="color:#f92672">button</span>&gt;
                    &lt;/<span style="color:#f92672">form</span>&gt;
                &lt;/<span style="color:#f92672">div</span>&gt;
            &lt;/<span style="color:#f92672">div</span>&gt;
        &lt;/<span style="color:#f92672">div</span>&gt;
    &lt;/<span style="color:#f92672">div</span>&gt;
&lt;/<span style="color:#f92672">div</span>&gt;
{% endblock %}
</code></pre></div><p><br></br>
最後就剩下detail和delete了，delate長得會有點像update</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-:app/app.py" data-lang=":app/app.py"><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/detail/&lt;user_id&gt;&#39;</span>)
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">detail</span>(user_id):
    user <span style="color:#f92672">=</span> User<span style="color:#f92672">.</span>query<span style="color:#f92672">.</span>filter_by(id<span style="color:#f92672">=</span>user_id)<span style="color:#f92672">.</span>first()
    <span style="color:#66d9ef">return</span> render_template(<span style="color:#e6db74">&#39;detail.html&#39;</span>, user<span style="color:#f92672">=</span>user)

<span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/delete/&lt;user_id&gt;&#39;</span>, methods<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;get&#39;</span>, <span style="color:#e6db74">&#39;post&#39;</span>])
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">delete</span>(user_id):
    user <span style="color:#f92672">=</span> User<span style="color:#f92672">.</span>query<span style="color:#f92672">.</span>filter_by(id<span style="color:#f92672">=</span>user_id)<span style="color:#f92672">.</span>first()
    <span style="color:#66d9ef">if</span> request<span style="color:#f92672">.</span>method <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;POST&#39;</span>:
        db<span style="color:#f92672">.</span>session<span style="color:#f92672">.</span>delete(user)
        db<span style="color:#f92672">.</span>session<span style="color:#f92672">.</span>commit()
        <span style="color:#66d9ef">return</span> redirect(url_for(<span style="color:#e6db74">&#39;list&#39;</span>))
    <span style="color:#66d9ef">return</span> render_template(<span style="color:#e6db74">&#39;detail.html&#39;</span>, user<span style="color:#f92672">=</span>user)
</code></pre></div><p><br></br>
template也能共用</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-:app/templates/detail.html" data-lang=":app/templates/detail.html">{% extends &#39;base.html&#39; %}
{% block content %}
&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;container mt-4&#34;</span>&gt;
    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;row&#34;</span>&gt;
        &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;col-12&#34;</span>&gt;
            &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;card&#34;</span>&gt;
                &lt;<span style="color:#f92672">h5</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;card-header&#34;</span>&gt;
                    {% if &#39;delete&#39; in request.path %}
                        Delete:
                    {% else %}
                        Detail:
                    {% endif %}
                    {{ user.username }}
                &lt;/<span style="color:#f92672">h5</span>&gt;
                &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;card-body&#34;</span>&gt;
                    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;row&#34;</span>&gt;
                        &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;col-3&#34;</span>&gt;
                            &lt;<span style="color:#f92672">p</span>&gt;Username&lt;/<span style="color:#f92672">p</span>&gt;
                        &lt;/<span style="color:#f92672">div</span>&gt;
                    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;col-9&#34;</span>&gt;
                            &lt;<span style="color:#f92672">p</span>&gt;{{ user.username }}&lt;/<span style="color:#f92672">p</span>&gt;
                    &lt;/<span style="color:#f92672">div</span>&gt;
                &lt;/<span style="color:#f92672">div</span>&gt;
                &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;row&#34;</span>&gt;
                    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;col-3&#34;</span>&gt;
                        &lt;<span style="color:#f92672">p</span>&gt;Email&lt;/<span style="color:#f92672">p</span>&gt;
                    &lt;/<span style="color:#f92672">div</span>&gt;
                    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;col-9&#34;</span>&gt;
                        &lt;<span style="color:#f92672">p</span>&gt;{{ user.email }}&lt;/<span style="color:#f92672">p</span>&gt;
                    &lt;/<span style="color:#f92672">div</span>&gt;
                &lt;/<span style="color:#f92672">div</span>&gt;
                &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;row&#34;</span>&gt;
                    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;col-3&#34;</span>&gt;
                        &lt;<span style="color:#f92672">p</span>&gt;Created at&lt;/<span style="color:#f92672">p</span>&gt;
                    &lt;/<span style="color:#f92672">div</span>&gt;
                    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;col-9&#34;</span>&gt;
                        &lt;<span style="color:#f92672">p</span>&gt;{{ user.created_at }}&lt;/<span style="color:#f92672">p</span>&gt;
                    &lt;/<span style="color:#f92672">div</span>&gt;
                &lt;/<span style="color:#f92672">div</span>&gt;
                &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;row&#34;</span>&gt;
                    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;col-3&#34;</span>&gt;
                        &lt;<span style="color:#f92672">p</span>&gt;Updated at&lt;/<span style="color:#f92672">p</span>&gt;
                    &lt;/<span style="color:#f92672">div</span>&gt;
                    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;col-9&#34;</span>&gt;
                        &lt;<span style="color:#f92672">p</span>&gt;{{ user.updated_at}}&lt;/<span style="color:#f92672">p</span>&gt;
                    &lt;/<span style="color:#f92672">div</span>&gt;
                &lt;/<span style="color:#f92672">div</span>&gt;
                {% if &#39;delete&#39; in request.path %} {# 當request.path包含delete時才出現的form #}
                &lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;post&#34;</span>&gt;
                    &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;btn btn-primary&#34;</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span>&gt;Delete&lt;/<span style="color:#f92672">button</span>&gt;
                &lt;/<span style="color:#f92672">form</span>&gt;
                {% endif %}
                &lt;/<span style="color:#f92672">div</span>&gt;
            &lt;/<span style="color:#f92672">div</span>&gt;
        &lt;/<span style="color:#f92672">div</span>&gt;
    &lt;/<span style="color:#f92672">div</span>&gt;
&lt;/<span style="color:#f92672">div</span>&gt;
{% endblock %}
</code></pre></div><p>到此就算大功告成啦！
<br></br>
也能從browser看看成果了</p>
<img style="display:inline;" width="150" src="1.png">
<img style="display:inline;" width="150" src="2.png">
<img style="display:inline;" width="150" src="3.png">
<img style="display:inline;" width="150" src="4.png">
<p><br></br>
但是到目前為止這App還不算完整，畢竟毫無安全性可言，下次就要加上CSRF了</p>


<v-card class="mt-5 content">
  <v-card-text>
  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "mikanmimi" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </v-card-text>
</v-card>
