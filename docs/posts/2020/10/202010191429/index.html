<p>回味一下以前用過的工具們，唯一不同的就是在Docker host上安裝，因為速度很快很適合測試之用，用在正式環境的話稍微tuning一下也不是不能用</p>
<p>這次部屬的有Cacti、Nagios、LibreNMS，單獨部屬太空洞所以三個塞一篇</p>
<ul>
<li><a onclick="window.scrollTo({top: document.getElementById(1).offsetTop, behavior: 'smooth'})">LibreNMS</a></li>
<li><a onclick="window.scrollTo({top: document.getElementById(2).offsetTop, behavior: 'smooth'})">Cacti</a></li>
<li><a onclick="window.scrollTo({top: document.getElementById(3).offsetTop, behavior: 'smooth'})">Nagios</a></li>
</ul>
<p><br></br>
本篇以最少最快為宗旨，以盡可能不變更任何檔案為原則</p>
<h3 id=1>LibreNMS</h3>
<hr>
<p><br></br>
首先是<strong>LibreNMS</strong>(<a href="https://www.librenms.org/">https://www.librenms.org/</a>)，算是個人比較喜歡的一個RRDtool based的監控工具，有點後起之秀的感覺，官方有提供docker的方式安裝，簡單快速</p>
<p>先下載librenms/docker的git repository</p>
<pre><code>$ git clone https://github.com/librenms/docker/
</code></pre><p><br></br></p>
<p>裡面很貼心的有個範例的compose file，而有些environment variable則放在兩個.env的檔案中，標註在下列四行</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-:docker/examples/compose/docker-compose.yml" data-lang=":docker/examples/compose/docker-compose.yml"><span style="color:#66d9ef">version</span>: <span style="color:#e6db74">&#34;3.5&#34;</span>

<span style="color:#66d9ef">services</span>:
  <span style="color:#66d9ef">db</span>:
    <span style="color:#66d9ef">image</span>: mariadb:<span style="color:#ae81ff">10.4</span>
    <span style="color:#66d9ef">container_name</span>: librenms_db
    <span style="color:#66d9ef">command</span>:
      - <span style="color:#e6db74">&#34;mysqld&#34;</span>
      - <span style="color:#e6db74">&#34;--innodb-file-per-table=1&#34;</span>
      - <span style="color:#e6db74">&#34;--lower-case-table-names=0&#34;</span>
      - <span style="color:#e6db74">&#34;--character-set-server=utf8&#34;</span>
      - <span style="color:#e6db74">&#34;--collation-server=utf8_unicode_ci&#34;</span>
    <span style="color:#66d9ef">volumes</span>:
      - <span style="color:#e6db74">&#34;./db:/var/lib/mysql&#34;</span>
    <span style="color:#66d9ef">environment</span>:
      - <span style="color:#e6db74">&#34;TZ=${TZ}&#34;</span>
      - <span style="color:#e6db74">&#34;MYSQL_ALLOW_EMPTY_PASSWORD=yes&#34;</span>
      - <span style="color:#e6db74">&#34;MYSQL_DATABASE=${MYSQL_DATABASE}&#34;</span>
      - <span style="color:#e6db74">&#34;MYSQL_USER=${MYSQL_USER}&#34;</span>
      - <span style="color:#e6db74">&#34;MYSQL_PASSWORD=${MYSQL_PASSWORD}&#34;</span>
    <span style="color:#66d9ef">restart</span>: always

  <span style="color:#66d9ef">memcached</span>:
    <span style="color:#66d9ef">image</span>: memcached:alpine
    <span style="color:#66d9ef">container_name</span>: librenms_memcached
    <span style="color:#66d9ef">environment</span>:
      - <span style="color:#e6db74">&#34;TZ=${TZ}&#34;</span>
    <span style="color:#66d9ef">restart</span>: always

  <span style="color:#66d9ef">redis</span>:
    <span style="color:#66d9ef">image</span>: redis:<span style="color:#ae81ff">5.0</span>-alpine
    <span style="color:#66d9ef">container_name</span>: librenms_redis
    <span style="color:#66d9ef">environment</span>:
      - <span style="color:#e6db74">&#34;TZ=${TZ}&#34;</span>
    <span style="color:#66d9ef">restart</span>: always

  <span style="color:#66d9ef">rrdcached</span>:
    <span style="color:#66d9ef">image</span>: crazymax/rrdcached
    <span style="color:#66d9ef">container_name</span>: librenms_rrdcached
    <span style="color:#66d9ef">volumes</span>:
      - <span style="color:#e6db74">&#34;./librenms/rrd:/data/db&#34;</span>
      - <span style="color:#e6db74">&#34;./rrd-journal:/data/journal&#34;</span>
    <span style="color:#66d9ef">environment</span>:
      - <span style="color:#e6db74">&#34;TZ=${TZ}&#34;</span>
      - <span style="color:#e6db74">&#34;PUID=${PUID}&#34;</span>
      - <span style="color:#e6db74">&#34;PGID=${PGID}&#34;</span>
      - <span style="color:#e6db74">&#34;LOG_LEVEL=LOG_INFO&#34;</span>
      - <span style="color:#e6db74">&#34;WRITE_TIMEOUT=1800&#34;</span>
      - <span style="color:#e6db74">&#34;WRITE_JITTER=1800&#34;</span>
      - <span style="color:#e6db74">&#34;WRITE_THREADS=4&#34;</span>
      - <span style="color:#e6db74">&#34;FLUSH_DEAD_DATA_INTERVAL=3600&#34;</span>
    <span style="color:#66d9ef">restart</span>: always

  <span style="color:#66d9ef">msmtpd</span>:
    <span style="color:#66d9ef">image</span>: crazymax/msmtpd:latest
    <span style="color:#66d9ef">container_name</span>: librenms_msmtpd
    <span style="color:#66d9ef">env_file</span>:
<span style="display:block;width:100%;background-color:#3c3d38">      - <span style="color:#e6db74">&#34;./msmtpd.env&#34;</span>
</span>    <span style="color:#66d9ef">restart</span>: always

  <span style="color:#66d9ef">librenms</span>:
    <span style="color:#66d9ef">image</span>: librenms/librenms:latest
    <span style="color:#66d9ef">container_name</span>: librenms
    <span style="color:#66d9ef">hostname</span>: librenms
    <span style="color:#66d9ef">ports</span>:
      - <span style="color:#66d9ef">target</span>: <span style="color:#ae81ff">8000</span>
        <span style="color:#66d9ef">published</span>: <span style="color:#ae81ff">8000</span>
        <span style="color:#66d9ef">protocol</span>: tcp
    <span style="color:#66d9ef">depends_on</span>:
      - db
      - memcached
      - rrdcached
      - msmtpd
    <span style="color:#66d9ef">volumes</span>:
      - <span style="color:#e6db74">&#34;./librenms:/data&#34;</span>
    <span style="color:#66d9ef">env_file</span>:
<span style="display:block;width:100%;background-color:#3c3d38">      - <span style="color:#e6db74">&#34;./librenms.env&#34;</span>
</span>    <span style="color:#66d9ef">environment</span>:
      - <span style="color:#e6db74">&#34;TZ=${TZ}&#34;</span>
      - <span style="color:#e6db74">&#34;PUID=${PUID}&#34;</span>
      - <span style="color:#e6db74">&#34;PGID=${PGID}&#34;</span>
      - <span style="color:#e6db74">&#34;DB_HOST=db&#34;</span>
      - <span style="color:#e6db74">&#34;DB_NAME=${MYSQL_DATABASE}&#34;</span>
      - <span style="color:#e6db74">&#34;DB_USER=${MYSQL_USER}&#34;</span>
      - <span style="color:#e6db74">&#34;DB_PASSWORD=${MYSQL_PASSWORD}&#34;</span>
      - <span style="color:#e6db74">&#34;DB_TIMEOUT=60&#34;</span>
    <span style="color:#66d9ef">restart</span>: always

  <span style="color:#66d9ef">dispatcher</span>:
    <span style="color:#66d9ef">image</span>: librenms/librenms:latest
    <span style="color:#66d9ef">container_name</span>: librenms_dispatcher
    <span style="color:#66d9ef">hostname</span>: librenms-dispatcher
    <span style="color:#66d9ef">depends_on</span>:
      - librenms
      - redis
    <span style="color:#66d9ef">volumes</span>:
      - <span style="color:#e6db74">&#34;./librenms:/data&#34;</span>
    <span style="color:#66d9ef">env_file</span>:
<span style="display:block;width:100%;background-color:#3c3d38">      - <span style="color:#e6db74">&#34;./librenms.env&#34;</span>
</span>    <span style="color:#66d9ef">environment</span>:
      - <span style="color:#e6db74">&#34;TZ=${TZ}&#34;</span>
      - <span style="color:#e6db74">&#34;PUID=${PUID}&#34;</span>
      - <span style="color:#e6db74">&#34;PGID=${PGID}&#34;</span>
      - <span style="color:#e6db74">&#34;DB_HOST=db&#34;</span>
      - <span style="color:#e6db74">&#34;DB_NAME=${MYSQL_DATABASE}&#34;</span>
      - <span style="color:#e6db74">&#34;DB_USER=${MYSQL_USER}&#34;</span>
      - <span style="color:#e6db74">&#34;DB_PASSWORD=${MYSQL_PASSWORD}&#34;</span>
      - <span style="color:#e6db74">&#34;DB_TIMEOUT=60&#34;</span>
      - <span style="color:#e6db74">&#34;DISPATCHER_NODE_ID=dispatcher1&#34;</span>
      - <span style="color:#e6db74">&#34;REDIS_HOST=redis&#34;</span>
      - <span style="color:#e6db74">&#34;REDIS_PORT=6379&#34;</span>
      - <span style="color:#e6db74">&#34;REDIS_DB=0&#34;</span>
      - <span style="color:#e6db74">&#34;SIDECAR_DISPATCHER=1&#34;</span>
    <span style="color:#66d9ef">restart</span>: always

  <span style="color:#66d9ef">syslogng</span>:
    <span style="color:#66d9ef">image</span>: librenms/librenms:latest
    <span style="color:#66d9ef">container_name</span>: librenms_syslogng
    <span style="color:#66d9ef">hostname</span>: librenms-syslogng
    <span style="color:#66d9ef">depends_on</span>:
      - librenms
    <span style="color:#66d9ef">ports</span>:
      - <span style="color:#66d9ef">target</span>: <span style="color:#ae81ff">514</span>
        <span style="color:#66d9ef">published</span>: <span style="color:#ae81ff">514</span>
        <span style="color:#66d9ef">protocol</span>: tcp
      - <span style="color:#66d9ef">target</span>: <span style="color:#ae81ff">514</span>
        <span style="color:#66d9ef">published</span>: <span style="color:#ae81ff">514</span>
        <span style="color:#66d9ef">protocol</span>: udp
    <span style="color:#66d9ef">volumes</span>:
      - <span style="color:#e6db74">&#34;./librenms:/data&#34;</span>
    <span style="color:#66d9ef">env_file</span>:
<span style="display:block;width:100%;background-color:#3c3d38">      - <span style="color:#e6db74">&#34;./librenms.env&#34;</span>
</span>    <span style="color:#66d9ef">environment</span>:
      - <span style="color:#e6db74">&#34;TZ=${TZ}&#34;</span>
      - <span style="color:#e6db74">&#34;PUID=${PUID}&#34;</span>
      - <span style="color:#e6db74">&#34;PGID=${PGID}&#34;</span>
      - <span style="color:#e6db74">&#34;DB_HOST=db&#34;</span>
      - <span style="color:#e6db74">&#34;DB_NAME=${MYSQL_DATABASE}&#34;</span>
      - <span style="color:#e6db74">&#34;DB_USER=${MYSQL_USER}&#34;</span>
      - <span style="color:#e6db74">&#34;DB_PASSWORD=${MYSQL_PASSWORD}&#34;</span>
      - <span style="color:#e6db74">&#34;DB_TIMEOUT=60&#34;</span>
      - <span style="color:#e6db74">&#34;SIDECAR_SYSLOGNG=1&#34;</span>
    <span style="color:#66d9ef">restart</span>: always
</code></pre></td></tr></table>
</div>
</div><p><br></br>
兩個.env的檔案</p>
<pre><code class="language-:docker/examples/compose/librenms.env" data-lang=":docker/examples/compose/librenms.env">MEMORY_LIMIT=256M
UPLOAD_MAX_SIZE=16M
OPCACHE_MEM_SIZE=128
REAL_IP_FROM=0.0.0.0/32
REAL_IP_HEADER=X-Forwarded-For
LOG_IP_VAR=remote_addr

LIBRENMS_SNMP_COMMUNITY=librenmsdocker
MEMCACHED_HOST=memcached
MEMCACHED_PORT=11211
RRDCACHED_HOST=rrdcached
RRDCACHED_PORT=42217

LIBRENMS_WEATHERMAP=false
LIBRENMS_WEATHERMAP_SCHEDULE=*/5 * * * *
</code></pre><p><br></br></p>
<pre><code class="language-:docker/examples/compose/msmtpd.env" data-lang=":docker/examples/compose/msmtpd.env"># https://github.com/crazy-max/docker-msmtpd
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_TLS=on
SMTP_STARTTLS=on
SMTP_TLS_CHECKCERT=on
SMTP_AUTH=on
SMTP_USER=foo
SMTP_PASSWORD=bar
SMTP_FROM=foo@gmail.com
</code></pre><p>如此一來能輕鬆部屬在任何docker-compose環境或swarm cluster
<br></br>
只要簡簡單單的指令就能使用了</p>
<pre><code>$ cd docker/examples/compose/
# docker-compose up
</code></pre><p><br></br>
連上剛才compose file裡記述的port 8000就能看到登入畫面，預設的帳號密碼皆為librenms</p>
<img style="display:inline;" width="50%" src="1.png">
<p><br></br></p>
<h3 id=2>Cacti</h3>
<hr>
<p><br></br>
老牌的RRDtool based監控工具<strong>Cacti</strong>(<a href="https://www.cacti.net/index.php">https://www.cacti.net/</a>)，和前面的LibreNMS不同，官方沒有docker的安裝方式</p>
<p>但這裡有大佬的範例<a href="https://github.com/scline/docker-cacti">https://github.com/scline/docker-cacti</a></p>
<pre><code>$ mkdir cacti
$ cd cacti
$ git clone https://github.com/scline/docker-cacti
</code></pre><p><br></br>
這裡選擇的是cacti_single_install.yml，cacti_multi_.yml與cacti_multi_shared.yml是multi node用的</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-:docker-cacti/docker-compose/cacti_single_install.yml" data-lang=":docker-cacti/docker-compose/cacti_single_install.yml"><span style="color:#66d9ef">version</span>: <span style="color:#e6db74">&#39;2&#39;</span>
<span style="color:#66d9ef">services</span>:


  <span style="color:#66d9ef">cacti</span>:
    <span style="color:#66d9ef">image</span>: <span style="color:#e6db74">&#34;smcline06/cacti&#34;</span>
    <span style="color:#66d9ef">container_name</span>: cacti
    <span style="color:#66d9ef">domainname</span>: example.com
    <span style="color:#66d9ef">hostname</span>: cacti
    <span style="color:#66d9ef">ports</span>:
      - <span style="color:#e6db74">&#34;80:80&#34;</span>
      - <span style="color:#e6db74">&#34;443:443&#34;</span>
    <span style="color:#66d9ef">environment</span>:
      - DB_NAME=cacti_master
      - DB_USER=cactiuser
      - DB_PASS=cactipassword
      - DB_HOST=db
      - DB_PORT=<span style="color:#ae81ff">3306</span>
      - DB_ROOT_PASS=rootpassword
      - INITIALIZE_DB=<span style="color:#ae81ff">1</span>
      - TZ=America/Los_Angeles
    <span style="color:#66d9ef">volumes</span>:
      - cacti-data:/cacti
      - cacti-spine:/spine
      - cacti-backups:/backups
    <span style="color:#66d9ef">links</span>:
      - db


  <span style="color:#66d9ef">db</span>:
    <span style="color:#66d9ef">image</span>: <span style="color:#e6db74">&#34;mariadb:10.3&#34;</span>
    <span style="color:#66d9ef">container_name</span>: cacti_db
    <span style="color:#66d9ef">domainname</span>: example.com
    <span style="color:#66d9ef">hostname</span>: db
    <span style="color:#66d9ef">ports</span>:
      - <span style="color:#e6db74">&#34;3306:3306&#34;</span>
    <span style="color:#66d9ef">command</span>:
      - mysqld
      - --character-set-server=utf8mb4
      - --collation-server=utf8mb4_unicode_ci
      - --max_connections=<span style="color:#ae81ff">200</span>
      - --max_heap_table_size=128M
      - --max_allowed_packet=32M
      - --tmp_table_size=128M
      - --join_buffer_size=128M
      - --innodb_buffer_pool_size=1G
      - --innodb_doublewrite=ON
      - --innodb_flush_log_at_timeout=<span style="color:#ae81ff">3</span>
      - --innodb_read_io_threads=<span style="color:#ae81ff">32</span>
      - --innodb_write_io_threads=<span style="color:#ae81ff">16</span>
      - --innodb_buffer_pool_instances=<span style="color:#ae81ff">9</span>
      - --innodb_file_format=Barracuda
      - --innodb_large_prefix=<span style="color:#ae81ff">1</span>
      - --innodb_io_capacity=<span style="color:#ae81ff">5000</span>
      - --innodb_io_capacity_max=<span style="color:#ae81ff">10000</span>
    <span style="color:#66d9ef">environment</span>:
      - MYSQL_ROOT_PASSWORD=rootpassword
      - TZ=America/Los_Angeles
    <span style="color:#66d9ef">volumes</span>:
      - cacti-db:/var/lib/mysql


<span style="color:#66d9ef">volumes</span>:
  <span style="color:#66d9ef">cacti-db</span>:
  <span style="color:#66d9ef">cacti-data</span>:
  <span style="color:#66d9ef">cacti-spine</span>:
  <span style="color:#66d9ef">cacti-backups</span>:
</code></pre></div><p><br></br>
docker-compose的設定預設是抓docker-compose.yml或docker-compose.yaml，不更改檔名的話就加上-f這個option</p>
<pre><code>$ cd docker-cacti/docker-compose
# docker-compose -f cacti_single_install.yml up
</code></pre><p><br></br>
連上compose file內記載的port 80即可看到招牌仙人掌，帳號密碼皆為admin，登入就可以開始初期設定了</p>
<img style="display:inline;" width="50%" src="2.png">
<p><br></br></p>
<h3 id=3>Nagios</h3>
<hr>
<p><br></br>
最後是<strong>Nagios</strong>(<a href="https://www.nagios.org/">https://www.nagios.org/</a>)，也是知名度挺高的老牌工具，似乎比Cacti年輕一點點，和cacti一樣使用大佬寫好的compose file</p>
<p><a href="https://github.com/ethnchao/docker-nagios">https://github.com/ethnchao/docker-nagios</a></p>
<p>一樣先下載git repo</p>
<pre><code>$ mkdir nagios
# git clone https://github.com/ethnchao/docker-nagios
</code></pre><p><br></br>
裡面就一個compose file</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-:docker-nagios/docker-compose.yml" data-lang=":docker-nagios/docker-compose.yml"><span style="color:#66d9ef">version</span>: <span style="color:#e6db74">&#39;2&#39;</span>
<span style="color:#66d9ef">services</span>:
  <span style="color:#66d9ef">nagios</span>:
    <span style="color:#66d9ef">image</span>: ethnchao/nagios
    <span style="color:#66d9ef">container_name</span>: nagios
    <span style="color:#66d9ef">command</span>: --enable-ndo --create-db --server-url http://<span style="color:#ae81ff">192.168.101.100</span>:<span style="color:#ae81ff">4000</span>
    <span style="color:#66d9ef">ports</span>:
      - <span style="color:#ae81ff">4000</span>:<span style="color:#ae81ff">80</span>
      - <span style="color:#ae81ff">4001</span>:<span style="color:#ae81ff">3000</span>
    <span style="color:#66d9ef">restart</span>: always
    <span style="color:#66d9ef">logging</span>:
      <span style="color:#66d9ef">options</span>:
        <span style="color:#66d9ef">max-size</span>: <span style="color:#e6db74">&#34;10m&#34;</span>
        <span style="color:#66d9ef">max-file</span>: <span style="color:#e6db74">&#34;10&#34;</span>
    <span style="color:#66d9ef">depends_on</span>:
      - nagios_mysql
    <span style="color:#66d9ef">volumes</span>:
      - ./data/plugin:/data/plugin
      - ./data/conf:/usr/local/nagios/etc/mount
      - ./data/example:/data/example

  <span style="color:#66d9ef">nagios_mysql</span>:
    <span style="color:#66d9ef">image</span>: mysql:<span style="color:#ae81ff">5.6</span>
    <span style="color:#66d9ef">container_name</span>: mysql
    <span style="color:#66d9ef">ports</span>:
      - <span style="color:#ae81ff">3306</span>:<span style="color:#ae81ff">3306</span>
    <span style="color:#66d9ef">restart</span>: always
    <span style="color:#66d9ef">logging</span>:
      <span style="color:#66d9ef">options</span>:
        <span style="color:#66d9ef">max-size</span>: <span style="color:#e6db74">&#34;10m&#34;</span>
        <span style="color:#66d9ef">max-file</span>: <span style="color:#e6db74">&#34;10&#34;</span>
    <span style="color:#66d9ef">environment</span>:
      - MYSQL_USER=nagios
      - MYSQL_PASSWORD=nagios
      - MYSQL_ADDRESS=nagios_mysql
      - MYSQL_DATABASE=nagios
      - MYSQL_RANDOM_ROOT_PASSWORD=yes
    <span style="color:#66d9ef">volumes</span>:
      - nagios_db_data:/var/lib/mysql

<span style="color:#66d9ef">volumes</span>:
  <span style="color:#66d9ef">nagios_db_data</span>:
</code></pre></div><p><br></br>
指令按下去就能部屬了</p>
<pre><code>$ cd docker-nagios
# docker-compose up
</code></pre><p><br></br>
完成後有port 4000的nagios(user: nagiosadmin, pass: nagios)與port 4001的grafana (user: admin, pass: admin)</p>
<img width="50%" src="3.png">
<img width="50%" src="4.png">