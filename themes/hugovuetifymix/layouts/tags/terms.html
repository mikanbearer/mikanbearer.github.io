{{ define "main" }}
<div id="app">
  <v-app id="inspire">
    <v-app id="inspire">
      {{ partial "header.html" . }}
      {{ partial "navbar" . }}
      <v-main>
        <v-container fluid style="width: 800px">
          <v-row dense>
            <v-col>
              <div class="text-h5">
                {{ .Title }}
              </div>

              <div class="mt-3">
                <v-tabs 
                  v-model="tab"
                  background-color="transparent"
                >
                  <v-tab>
                    List
                  </v-tab>
                  <v-tab>
                    Filter
                  </v-tab>
                </v-tabs>
              
                <v-tabs-items v-model="tab">
                  <v-tab-item>
                    <v-expansion-panels focusable inset>
                      {{ range $key, $value := .Data.Terms.ByCount }}
                      <v-expansion-panel>
                        <v-expansion-panel-header>
                          <div class="text-h6">   
                            <v-badge content="{{ $value.Count }}">
                              {{ $value.Page.Title }}
                            </v-badge>
                          </div>
                        </v-expansion-panel-header>
                        <v-expansion-panel-content>
                          <v-simple-table>
                            <template>
                              <tbody>
                                {{ range $value.Pages }}
                                <tr>
                                  <td>{{ .Date.Format "2006-01-02" }}</td>
                                  <td>
                                    {{ if .Params.Categories }}
                                    {{ range .Params.Categories }}
                                      <a href="{{ $.Site.LanguagePrefix | absURL }}categories/{{ . | urlize }}/">{{ . }}</a>
                                    {{ end }}
                                  {{ end }}
                                  </td>
                                  <td><a href="{{ .Permalink }}">{{ .Title }}</a></td>
                                </tr>
                                {{ end }}
                              </tbody>
                              </template>
                          </v-simple-table>
                        </v-expansion-panel-content>
                      </v-expansion-panel>
                      {{ end }}
                    </v-expansion-panels>
                  </v-tab-item>
                  <v-tab-item>
                    <v-combobox 
                    v-model="seltags"
                    :items="tags"
                    chips
                    clearable
                    label="Tags"
                    multiple
                    solo
                    hide-selected
                  >
                    <template v-slot:selection="{ attrs, item, select, selected }">
                      <v-chip
                        color="red"
                        v-bind="attrs"
                        :input-value="selected"
                        close
                        @click:close="remove(item)"
                      >
                        [[ item ]]
                      </v-chip>
                    </template>              
                  </v-combobox>
    
                  <v-simple-table>
                    <template>
                      <thead>
                        <tr>
                          <th class="text-left">Date</th>
                          <th class="text-left">Tags</th>
                          <th class="text-left">Title</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr v-for="post in filteredposts">
                          <td>[[ post.date ]]</td>
                          <td>
                            <div v-for="tag in post.tags" class="d-inline">
                              <v-chip
                                v-if="seltags.includes(tag)"
                                color="red"
                                label
                                text-color="white"
                                x-small
                                :href="'{{ "" | absLangURL }}tags/' + tag"
                                class="mr-1"
                              >
                                [[ tag ]]
                              </v-chip>
                              <v-chip
                                v-else
                                color="blue-grey"
                                label
                                text-color="white"
                                x-small
                                :href="'{{ "" | absLangURL }}tags/' + tag"
                                class="mr-1"
                              >
                                [[ tag ]]
                              </v-chip>
                            </div>
                          </td>
                          <td><a :href="post.url">[[ post.title ]]</a></td>
                        </tr>
                      </tbody>
                    </template>
                  </v-simple-table>
                  </v-tab-item>
                </v-tabs-items>
              </div>

            </v-col>
          </v-row>
        </v-container>
      </v-main>          
    </v-app>
  </v-app>
</div>
{{ partial "footer" . }}

<script>
  let alltags = [
  {{ range .Pages }}
    '{{ .Title }}',
  {{end}}
  ]
  
  vm.$set(vm.$data, 'tags', alltags.sort())


  vm.$watch(() => vm.seltags, (tags)=>{
    var filteredposts = []
    if (tags.length > 0) {
      for (const post of vm.posts) {
          let checker = (arr, target) => target.every(v => arr.includes(v))
         if (checker(post.tags, tags)) {
              filteredposts.push(post)
         }
      }
      vm.$set(vm.$data, 'filteredposts', filteredposts.reverse())
    }else{
      vm.$set(vm.$data, 'filteredposts', [])
    }
})

</script>

{{ end }}


