{{ define "main" }}
<div id="app">
  <v-app id="inspire">
{{ partial "header.html" . }}
{{ partial "navbar" . }}
    <v-app id="inspire">
      <v-main>
        <v-container fluid style="width: 800px">
          <v-row dense>
            <v-col>
              <div class="text-h5">
                {{ .Title }}
              </div>
              
              <div>
                <v-combobox 
                  v-model="seltags"
                  :items="tags"
                  chips
                  clearable
                  label="Tags"
                  multiple
                  solo
                  hide-selected
                >
                  <template v-slot:selection="{ attrs, item, select, selected }">
                    <v-chip
                      color="red"
                      v-bind="attrs"
                      :input-value="selected"
                      close
                      @click:close="remove(item)"
                    >
                      [[ item ]]
                    </v-chip>
                  </template>              
                </v-combobox>
  
                <v-simple-table>
                  <template>
                    <tbody>
                      <tr v-for="post in filteredposts">
                        <td>[[ post.date ]]</td>
                        <td>
                          <div v-for="tag in post.tags" class="d-inline">
                            <v-chip
                              v-if="seltags.includes(tag)"
                              color="red"
                              label
                              text-color="white"
                              x-small
                              :href="'{{ "" | absLangURL }}tags/' + tag"
                              class="mr-1"
                            >
                              [[ tag ]]
                            </v-chip>
                            <v-chip
                              v-else
                              color="blue-grey"
                              label
                              text-color="white"
                              x-small
                              :href="'{{ "" | absLangURL }}tags/' + tag"
                              class="mr-1"
                            >
                              [[ tag ]]
                            </v-chip>
                          </div>
                        </td>
                        <td><a :href="post.url">[[ post.title ]]</a></td>
                      </tr>
                    </tbody>
                  </template>
                </v-simple-table>
              </div>
            </v-col>
          </v-row>
        </v-container>
      </v-main> 
    </v-app>
  </v-app>  
</div>

{{ partial "footer" . }}


<script>
let alltags = []
posts.forEach(element => {alltags = alltags.concat(element.tags)})
alltags = Array.from(new Set(alltags))

vm.$set(vm.$data, 'tags', alltags.sort())

vm.$watch(() => vm.seltags, (tags)=>{
    var filteredposts = []
    for (const post of vm.posts) {
        let checker = (arr, target) => target.every(v => arr.includes(v))
        if (checker(post.tags, tags)) {
            filteredposts.push(post)
        }
    }
 
    vm.$set(vm.$data, 'filteredposts', filteredposts.reverse())
})

</script>
{{ end }}