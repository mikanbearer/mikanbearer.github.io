---
title: "練習建立簡單的Spring Boot RESTful"
date: 2021-03-04T09:27:24+08:00
draft: false
categories: [Web Devlopment]
tags: [Java, Spring]
isCJKLanguage: true
---

最近剛好接手維護一個使用Spring撰寫的MVC Project，一時興起就來接觸一下Java的MVC了，雖然Java對個人來說仍是陌生的語言…
  
這次練習不直接使用Spring，而是使用Spring Boot來構成Project，就以一個基礎的RESTful為目標
<!--more-->



* <a onclick="window.scrollTo({top: document.getElementById(1).offsetTop, behavior: 'smooth'})">建立Spring Boot Project</a>
* <a onclick="window.scrollTo({top: document.getElementById(2).offsetTop, behavior: 'smooth'})">建立Model與Controller</a>
<br></br>


<h3 id=1>建立Spring Boot Project</h3>

---
<br></br>
這裡有<a href="https://start.spring.io/" target="_blank">Initializr</a>，不求新求變，用預設的就好

![](1.png)
<br></br>


接下來設定controller，如範例<a href="https://spring.io/quickstart" target="_blank">Quick Start</a>的Hello World作為測試
```java {linenos=table, hl_lines=[9]}
package com.example.demo;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

@SpringBootApplication
@RestController
public class DemoApplication {

    public static void main(String[] args) {
        SpringApplication.run(DemoApplication.class, args);
    }

    @GetMapping("/hello")
    public String hello(@RequestParam(value = "name", defaultValue = "World") String name) {
        return String.format("Hello %s!", name);
    }
}
```
這時就不得不說一下這名為`@SpringBootApplication`的annotation，這其中其實包含了
* @SpringBootConfiguration：繼承自@Configuration
* @EnableAutoConfiguration：自動加入需要的Bean
* @ComponentScan：掃描當前package底下所有class

<br></br>
因此之後的class只要放在同個package中，就會透過此annotation加入servlet container內
<br></br>

接下來使用`mvnw spring-boot:run`就能執行，內含一個tomcat，預設是port 8080
```
> mvnw spring-boot:run
...
[INFO] --- spring-boot-maven-plugin:2.4.3:run (default-cli) @ demo ---
[INFO] Attaching agents: []

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v2.4.3)
 ...
2021-03-09 10:55:07.345  INFO 10860 --- [           main] com.example.demo.DemoApplication         : No active profile set, falling back to default profiles: default
2021-03-09 10:55:08.694  INFO 10860 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)
```
<br></br>

環境是windows，就直接用powershell發一個request
```
> (Invoke-WebRequest http://127.0.0.1:8080/hello).Content
Hello World!

> (Invoke-WebRequest http://127.0.0.1:8080/hello?name=abc).Content
Hello abc!
```
<br></br>












<h3 id=2>建立Model與Controller</h3>

---
<br></br>

接下來測試JSON Response，依照下列的樹狀圖建立兩個class
```
src
├─main
│  ├─java
│  │  └─com
│  │      └─example
│  │          └─demo
│  │                  DemoApplication.java
│  │                  Greeting.java ★
│  │                  GreetingController.java ★
....
```
<br></br>


首先在之前application class的同個package下，建立一個新的controller，宣告一個string與counter
```:GreetingController.java {linenos=table}
package com.example.demo;


import java.util.concurrent.atomic.AtomicLong;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class GreetingController {

    private static final String template = "Hello, %s!";
    private final AtomicLong counter = new AtomicLong();

    @GetMapping("/greeting")
    public Greeting greeting(@RequestParam(value = "name", defaultValue = "World") String name) {
        return new Greeting(counter.incrementAndGet(), String.format(template, name));
    }
}
```
<br></br>


接下來這是一個model，這時候還用不到DB
```:Greeting.java {linenos=table}
package com.example.demo;


public class Greeting {

    private final long id;
    private final String content;

    public Greeting(long id, String content) {
        this.id = id;
        this.content = content;
    }

    public long getId() {
        return id;
    }

    public String getContent() {
        return content;
    }
}
```
<br></br>

接著測試一下JSON response
```
> (Invoke-WebRequest http://127.0.0.1:8080/greeting).Content
{"id":1,"content":"Hello, World!"}

> (Invoke-WebRequest http://127.0.0.1:8080/greeting?name=123).Content
{"id":2,"content":"Hello, 123!"}
```